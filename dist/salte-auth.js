!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("salte-auth",[],e):"object"==typeof exports?exports["salte-auth"]=e():t["salte-auth"]=e()}(this,function(){return function(t){function e(o){if(i[o])return i[o].exports;var s=i[o]={exports:{},id:o,loaded:!1};return t[o].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){return o=function(t){if(this.REQUEST_TYPE={LOGIN:"LOGIN",RENEW_TOKEN:"RENEW_TOKEN",UNKNOWN:"UNKNOWN"},this.CONSTANTS={ACCESS_TOKEN:"access_token",EXPIRES_IN:"expires_in",ID_TOKEN:"id_token",ERROR_DESCRIPTION:"error_description",SESSION_STATE:"session_state",STORAGE:{TOKEN_KEYS:"adal.token.keys",ACCESS_TOKEN_KEY:"adal.access.token.key",EXPIRATION_KEY:"adal.expiration.key",STATE_LOGIN:"adal.state.login",STATE_RENEW:"adal.state.renew",NONCE_IDTOKEN:"adal.nonce.idtoken",SESSION_STATE:"adal.session.state",USERNAME:"adal.username",IDTOKEN:"adal.idtoken",ERROR:"adal.error",ERROR_DESCRIPTION:"adal.error.description",LOGIN_REQUEST:"adal.login.request",LOGIN_ERROR:"adal.login.error",RENEW_STATUS:"adal.token.renew.status"},RESOURCE_DELIMETER:"|",LOADFRAME_TIMEOUT:"6000",TOKEN_RENEW_STATUS_CANCELED:"Canceled",TOKEN_RENEW_STATUS_COMPLETED:"Completed",TOKEN_RENEW_STATUS_IN_PROGRESS:"In Progress",LOGGING_LEVEL:{ERROR:0,WARN:1,INFO:2,VERBOSE:3},LEVEL_STRING_MAP:{0:"ERROR:",1:"WARNING:",2:"INFO:",3:"VERBOSE:"},POPUP_WIDTH:483,POPUP_HEIGHT:600},o.prototype._singletonInstance)return o.prototype._singletonInstance;if(o.prototype._singletonInstance=this,this.instance="https://login.microsoftonline.com/",this.config={},this.callback=null,this.popUp=!1,this.isAngular=!1,this._user=null,this._activeRenewals={},this._loginInProgress=!1,this._renewStates=[],window.callBackMappedToRenewStates={},window.callBacksMappedToRenewStates={},t.displayCall&&"function"!=typeof t.displayCall)throw new Error("displayCall is not a function");if(!t.clientId)throw new Error("clientId is required");this.config=this._cloneConfig(t),this.config.popUp&&(this.popUp=!0),this.config.callback&&"function"==typeof this.config.callback&&(this.callback=this.config.callback),this.config.instance&&(this.instance=this.config.instance),this.config.loginResource||(this.config.loginResource=this.config.clientId),this.config.redirectUri||(this.config.redirectUri=window.location.href),this.config.anonymousEndpoints||(this.config.anonymousEndpoints=[]),this.config.isAngular&&(this.isAngular=this.config.isAngular),this._initResponseType()},o.prototype._initResponseType=function(){this.config.responseType||(this.config.responseType=this.CONSTANTS.ID_TOKEN)},window.Logging={level:0,log:function(t){}},o.prototype.login=function(t){if(this._loginInProgress)return void this.info("Login in progress");var e=this._guid();this.config.state=e,this._idTokenNonce=this._guid(),t||(t=window.location),this.verbose("Expected state: "+e+" startPage:"+t),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,t),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,e),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var i=this._getNavigateUrl(this.config.responseType,null)+"&nonce="+encodeURIComponent(this._idTokenNonce);return this._loginInProgress=!0,this.popUp?void this._loginPopup(i):void(this.config.displayCall?this.config.displayCall(i):this.promptUser(i))},o.prototype._openPopup=function(t,e,i,o){try{var s=window.screenLeft?window.screenLeft:window.screenX,n=window.screenTop?window.screenTop:window.screenY,r=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,h=r/2-i/2+s,T=a/2-o/2+n,c=window.open(t,e,"width="+i+", height="+o+", top="+T+", left="+h);return c.focus&&c.focus(),c}catch(S){return this.warn("Error opening popup, "+S.message),this._loginInProgress=!1,null}},o.prototype._loginPopup=function(t){var e=this._openPopup(t,"login",this.CONSTANTS.POPUP_WIDTH,this.CONSTANTS.POPUP_HEIGHT);if(null===e)return this.warn("Popup Window is null. This can happen if you are using IE"),this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Error opening popup"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Popup Window is null. This can happen if you are using IE"),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Popup Window is null. This can happen if you are using IE"),void(this.callback&&this.callback(this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR),null));var i;i=this.config.redirectUri.indexOf("#")===-1?this.config.redirectUri:this.config.redirectUri.split("#")[0];var o=this,s=window.setInterval(function(){e&&!e.closed&&void 0!==e.closed||(o._loginInProgress=!1,window.clearInterval(s));try{e.location.href.indexOf(i)!==-1&&(o.isAngular?window.location.hash=e.location.hash:o.handleWindowCallback(e.location.hash,e.location.search),window.clearInterval(s),o._loginInProgress=!1,o.info("Closing popup window"),e.close())}catch(t){}},20)},o.prototype.loginInProgress=function(){return this._loginInProgress},o.prototype._hasResource=function(t){var e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);return e&&!this._isEmpty(e)&&e.indexOf(t+this.CONSTANTS.RESOURCE_DELIMETER)>-1},o.prototype.getCachedToken=function(t){if(!this._hasResource(t))return null;var e=this._getItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t),i=this._getItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t),o=this.config.expireOffsetSeconds||120;return i&&i>this._now()+o?e:(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t,0),null)},o.prototype.getCachedUser=function(){if(this._user)return this._user;var t=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);return this._user=this._createUser(t),this._user},o.prototype.registerCallback=function(t,e,i){this._activeRenewals[e]=t,window.callBacksMappedToRenewStates[t]||(window.callBacksMappedToRenewStates[t]=[]);var o=this;window.callBacksMappedToRenewStates[t].push(i),window.callBackMappedToRenewStates[t]||(window.callBackMappedToRenewStates[t]=function(i,s){for(var n=0;n<window.callBacksMappedToRenewStates[t].length;++n)try{window.callBacksMappedToRenewStates[t][n](i,s)}catch(r){o.warn(r)}o._activeRenewals[e]=null,window.callBacksMappedToRenewStates[t]=null,window.callBackMappedToRenewStates[t]=null})},o.prototype._renewToken=function(t,e){this.info("renewToken is called for resource:"+t);var i=this._addAdalFrame("adalRenewFrame"+t),o=this._guid()+"|"+t;this.config.state=o,this._renewStates.push(o),this.verbose("Renew token Expected state: "+o);var s=this._getNavigateUrl("token",t)+"&prompt=none";s=this._addHintParameters(s),this.registerCallback(o,t,e),this.verbose("Navigate to:"+s),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,""),i.src="about:blank",this._loadFrameTimeout(s,"adalRenewFrame"+t,t)},o.prototype._renewIdToken=function(t){this.info("renewIdToken is called");var e=this._addAdalFrame("adalIdTokenFrame"),i=this._guid()+"|"+this.config.clientId;this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce),this.config.state=i,this._renewStates.push(i),this.verbose("Renew Idtoken Expected state: "+i);var o=this._getNavigateUrl(this.config.responseType,null)+"&prompt=none";o=this._addHintParameters(o),o+="&nonce="+encodeURIComponent(this._idTokenNonce),this.registerCallback(i,this.config.clientId,t),this.idTokenNonce=null,this.verbose("Navigate to:"+o),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,""),e.src="about:blank",this._loadFrameTimeout(o,"adalIdTokenFrame",this.config.clientId)},o.prototype._urlContainsQueryStringParameter=function(t,e){var i=new RegExp("[\\?&]"+t+"=");return i.test(e)},o.prototype._loadFrameTimeout=function(t,e,i){this.verbose("Set loading state to pending for: "+i),this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+i,this.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS),this._loadFrame(t,e);var o=this;setTimeout(function(){if(o._getItem(o.CONSTANTS.STORAGE.RENEW_STATUS+i)===o.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS){o.verbose("Loading frame has timed out after: "+o.CONSTANTS.LOADFRAME_TIMEOUT/1e3+" seconds for resource "+i);var t=o._activeRenewals[i];t&&window.callBackMappedToRenewStates[t]&&window.callBackMappedToRenewStates[t]("Token renewal operation failed due to timeout",null),o._saveItem(o.CONSTANTS.STORAGE.RENEW_STATUS+i,o.CONSTANTS.TOKEN_RENEW_STATUS_CANCELED)}},o.CONSTANTS.LOADFRAME_TIMEOUT)},o.prototype._loadFrame=function(t,e){var i=this;i.info("LoadFrame: "+e);var o=e;setTimeout(function(){var e=i._addAdalFrame(o);""!==e.src&&"about:blank"!==e.src||(e.src=t,i._loadFrame(t,o))},500)},o.prototype.acquireToken=function(t,e){if(this._isEmpty(t))return this.warn("resource is required"),void e("resource is required",null);var i=this.getCachedToken(t);return i?(this.info("Token is already in cache for resource:"+t),void e(null,i)):this._user?void(this._activeRenewals[t]?this.registerCallback(this._activeRenewals[t],t,e):t===this.config.clientId?(this.verbose("renewing idtoken"),this._renewIdToken(e)):this._renewToken(t,e)):(this.warn("User login is required"),void e("User login is required",null))},o.prototype.promptUser=function(t){t?(this.info("Navigate to:"+t),window.location.replace(t)):this.info("Navigate url is empty")},o.prototype.clearCache=function(){this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY,0),this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._renewStates=[],this._saveItem(this.CONSTANTS.STORAGE.USERNAME,""),this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);if(!this._isEmpty(t)){t=t.split(this.CONSTANTS.RESOURCE_DELIMETER);for(var e=0;e<t.length;e++)this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t[e],""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t[e],0)}this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,"")},o.prototype.clearCacheForResource=function(t){this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._hasResource(t)&&(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t,0))},o.prototype.logOut=function(){this.clearCache();var t="";this._user=null,this.config.postLogoutRedirectUri&&(t="post_logout_redirect_uri="+encodeURIComponent(this.config.postLogoutRedirectUri));var e=this._getBaseUrl()+"logout?"+t;this.info("Logout navigate to: "+e),this.promptUser(e)},o.prototype._isEmpty=function(t){return"undefined"==typeof t||!t||0===t.length},o.prototype.getUser=function(t){if("function"!=typeof t)throw new Error("callback is not a function");if(this._user)return void t(null,this._user);var e=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);this._isEmpty(e)?(this.warn("User information is not available"),t("User information is not available")):(this.info("User exists in cache: "),this._user=this._createUser(e),t(null,this._user))},o.prototype._addHintParameters=function(t){if(this._user&&this._user.profile&&this._user.profile.hasOwnProperty("upn")&&(t+="&login_hint="+encodeURIComponent(this._user.profile.upn),!this._urlContainsQueryStringParameter("domain_hint",t)&&this._user.profile.upn.indexOf("@")>-1)){var e=this._user.profile.upn.split("@");t+="&domain_hint="+encodeURIComponent(e[e.length-1])}return t},o.prototype._createUser=function(t){var e=null,i=this._extractIdToken(t);if(i&&i.hasOwnProperty("aud")){var o=!1;if(Array.isArray(i.aud)){if(i.hasOwnProperty("azp")&&i.azp.toLowerCase()===this.config.clientId.toLowerCase())for(var s=0;s<i.aud.length;s++)if(i.aud[s].toLowerCase()===this.config.clientId.toLowerCase()){o=!0;break}}else o=i.aud.toLowerCase()===this.config.clientId.toLowerCase();o?(e={userName:"",profile:i},i.hasOwnProperty("upn")?e.userName=i.upn:i.hasOwnProperty("email")?e.userName=i.email:i.hasOwnProperty("sub")&&(e.userName=i.sub)):this.warn("IdToken has invalid aud/azp field")}return e},o.prototype._getHash=function(t){return t.indexOf("#/")>-1?t=t.substring(t.indexOf("#/")+2):t.indexOf("#")>-1&&(t=t.substring(1)),t},o.prototype._getSearch=function(t){return t.indexOf("?")>-1&&(t=t.substring(1)),t},o.prototype._getParameters=function(t,e){var i={};if(t&&(t=this._getHash(t),i=this._deserialize(t)),e){e=this._getSearch(e);var o=this._deserialize(e);i=this._extend(i,o)}return i},o.prototype._extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},o.prototype.isCallback=function(t,e){var i=this._getParameters(t,e);return i.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||i.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||i.hasOwnProperty(this.CONSTANTS.ID_TOKEN)},o.prototype.getLoginError=function(){return this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR)},o.prototype.getRequestInfo=function(t,e){var i=this._getParameters(t,e),o={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:this.REQUEST_TYPE.UNKNOWN};if(i&&(o.parameters=i,i.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||i.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||i.hasOwnProperty(this.CONSTANTS.ID_TOKEN))){o.valid=!0;var s="";if(!i.hasOwnProperty("state"))return this.warn("No state returned"),o;if(this.verbose("State: "+i.state),s=i.state,o.stateResponse=s,s===this._getItem(this.CONSTANTS.STORAGE.STATE_LOGIN))return o.requestType=this.REQUEST_TYPE.LOGIN,o.stateMatch=!0,o;if(!o.stateMatch&&window.parent&&window.parent.AuthenticationContext)for(var n=window.parent.AuthenticationContext()._renewStates,r=0;r<n.length;r++)if(n[r]===o.stateResponse){o.requestType=this.REQUEST_TYPE.RENEW_TOKEN,o.stateMatch=!0;break}}return o},o.prototype._getResourceFromState=function(t){if(t){var e=t.indexOf("|");if(e>-1&&e+1<t.length)return t.substring(e+1)}return""},o.prototype.saveTokenFromHash=function(t){this.info("State status:"+t.stateMatch+"; Request type:"+t.requestType),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var e=this._getResourceFromState(t.stateResponse);if(t.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION))this.info("Error :"+t.parameters.error+"; Error description:"+t.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),this._saveItem(this.CONSTANTS.STORAGE.ERROR,t.parameters.error),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,t.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),t.requestType===this.REQUEST_TYPE.LOGIN&&(this._loginInProgress=!1,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,t.parameters.error_description));else if(t.stateMatch){this.info("State is right"),t.parameters.hasOwnProperty(this.CONSTANTS.SESSION_STATE)&&this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,t.parameters[this.CONSTANTS.SESSION_STATE]);var i;t.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)&&(this.info("Fragment has access token"),this._hasResource(e)||(i=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,i+e+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e,t.parameters[this.CONSTANTS.ACCESS_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e,this._expiresIn(t.parameters[this.CONSTANTS.EXPIRES_IN]))),t.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)&&(this.info("Fragment has id token"),this._loginInProgress=!1,this._user=this._createUser(t.parameters[this.CONSTANTS.ID_TOKEN]),this._user&&this._user.profile?this._user.profile.nonce===this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN)?(this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,t.parameters[this.CONSTANTS.ID_TOKEN]),e=this.config.loginResource?this.config.loginResource:this.config.clientId,this._hasResource(e)||(i=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,i+e+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e,t.parameters[this.CONSTANTS.ID_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e,this._user.profile.exp)):(this._user=null,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Nonce is not same as "+this._idTokenNonce)):(this._saveItem(this.CONSTANTS.STORAGE.ERROR,"invalid id_token"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid id_token. id_token: "+t.parameters[this.CONSTANTS.ID_TOKEN])))}else this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Invalid_state"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid_state. state: "+t.stateResponse);this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+e,this.CONSTANTS.TOKEN_RENEW_STATUS_COMPLETED)},o.prototype.getResourceForEndpoint=function(t){if(this.config&&this.config.endpoints)for(var e in this.config.endpoints)if(t.indexOf(e)>-1)return this.config.endpoints[e];if(!(t.indexOf("http://")>-1||t.indexOf("https://")>-1)){if(this.config&&this.config.anonymousEndpoints)for(var i=0;i<this.config.anonymousEndpoints.length;i++)if(t.indexOf(this.config.anonymousEndpoints[i])>-1)return null;return this.config.loginResource}return this._getHostFromUri(t)===this._getHostFromUri(this.config.redirectUri)?this.config.loginResource:null},o.prototype._getHostFromUri=function(t){var e=String(t).replace(/^(https?:)\/\//,"");return e=e.split("/")[0]},o.prototype.handleWindowCallback=function(t,e){if(t||(t=window.location.hash),e||(e=window.location.search),this.isCallback(t,e)){var i=this.getRequestInfo(t,e);this.info("Returned from redirect url"),this.saveTokenFromHash(i);var o=null;if(i.requestType===this.REQUEST_TYPE.RENEW_TOKEN&&window.parent&&window.parent!==window)return this.verbose("Window is in iframe"),o=window.parent.callBackMappedToRenewStates[i.stateResponse],void(o&&o(this._getItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION),i.parameters[this.CONSTANTS.ACCESS_TOKEN]||i.parameters[this.CONSTANTS.ID_TOKEN]));i.requestType===this.REQUEST_TYPE.LOGIN&&(o=this.callback,o&&o(this._getItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION),i.parameters[this.CONSTANTS.ID_TOKEN])),this.popUp||(window.location=this._getItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST))}},o.prototype._getNavigateUrl=function(t,e){var i=this._getBaseUrl()+"authorize"+this._serialize(t,this.config,e)+this._addLibMetadata();return this.config.scope&&(i+="&scope="+encodeURIComponent(this.config.scope)),this.info("Navigate url:"+i),i},o.prototype._getBaseUrl=function(){var t="common",e="oauth2",i=this.instance;return[void 0,null].indexOf(this.config.tenant)===-1&&(t=this.config.tenant),[void 0,null].indexOf(this.config.rootContext)===-1&&(e=this.config.rootContext),t&&(i+=t+"/"),e&&(i+=e+"/"),i},o.prototype._extractIdToken=function(t){var e=this._decodeJwt(t);if(!e)return null;try{var i=e.JWSPayload,o=this._base64DecodeStringUrlSafe(i);return o?JSON.parse(o):(this.info("The returned id_token could not be base64 url safe decoded."),null)}catch(s){this.error("The returned id_token could not be decoded",s)}return null},o.prototype._base64DecodeStringUrlSafe=function(t){return t=t.replace(/-/g,"+").replace(/_/g,"/"),window.atob?decodeURIComponent(escape(window.atob(t))):decodeURIComponent(escape(this._decode(t)))},o.prototype._decode=function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t=String(t).replace(/[=]+$/,"");var i=t.length;if(i%4===1)throw new Error("The token to be decoded is not correctly encoded.");for(var o,s,n,r,a,h,T,c,S="",l=0;l<i;l+=4){if(o=e.indexOf(t.charAt(l)),s=e.indexOf(t.charAt(l+1)),n=e.indexOf(t.charAt(l+2)),r=e.indexOf(t.charAt(l+3)),l+2===i-1){a=o<<18|s<<12|n<<6,h=a>>16&255,T=a>>8&255,S+=String.fromCharCode(h,T);break}if(l+1===i-1){a=o<<18|s<<12,h=a>>16&255,S+=String.fromCharCode(h);break}a=o<<18|s<<12|n<<6|r,h=a>>16&255,T=a>>8&255,c=255&a,S+=String.fromCharCode(h,T,c)}return S},o.prototype._decodeJwt=function(t){if(this._isEmpty(t))return null;var e=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/,i=e.exec(t);if(!i||i.length<4)return this.warn("The returned id_token is not parseable."),null;var o={header:i[1],JWSPayload:i[2],JWSSig:i[3]};return o},o.prototype._convertUrlSafeToRegularBase64EncodedString=function(t){return t.replace("-","+").replace("_","/")},o.prototype._serialize=function(t,e,i){var o=[];if(null!==e){o.push("?response_type="+encodeURIComponent(t)),o.push("client_id="+encodeURIComponent(e.clientId)),i&&o.push("resource="+encodeURIComponent(i)),o.push("redirect_uri="+encodeURIComponent(e.redirectUri)),o.push("state="+encodeURIComponent(e.state)),e.hasOwnProperty("slice")&&o.push("slice="+encodeURIComponent(e.slice)),e.hasOwnProperty("extraQueryParameter")&&o.push(e.extraQueryParameter);var s=e.correlationId?e.correlationId:this._guid();o.push("client-request-id="+encodeURIComponent(s))}return o.join("&")},o.prototype._deserialize=function(t){var e,i=/\+/g,o=/([^&=]+)=([^&]*)/g,s=function(t){return decodeURIComponent(t.replace(i," "))},n={};for(e=o.exec(t);e;)n[s(e[1])]=s(e[2]),e=o.exec(t);return n},o.prototype._decimalToHex=function(t){for(var e=t.toString(16);e.length<2;)e="0"+e;return e},o.prototype._guid=function(){var t=window.crypto||window.msCrypto;if(t&&t.getRandomValues){var e=new Uint8Array(16);return t.getRandomValues(e),e[6]|=64,e[6]&=79,e[8]|=128,e[8]&=191,this._decimalToHex(e[0])+this._decimalToHex(e[1])+this._decimalToHex(e[2])+this._decimalToHex(e[3])+"-"+this._decimalToHex(e[4])+this._decimalToHex(e[5])+"-"+this._decimalToHex(e[6])+this._decimalToHex(e[7])+"-"+this._decimalToHex(e[8])+this._decimalToHex(e[9])+"-"+this._decimalToHex(e[10])+this._decimalToHex(e[11])+this._decimalToHex(e[12])+this._decimalToHex(e[13])+this._decimalToHex(e[14])+this._decimalToHex(e[15])}for(var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",o="0123456789abcdef",s=0,n="",r=0;r<36;r++)"-"!==i[r]&&"4"!==i[r]&&(s=16*Math.random()|0),"x"===i[r]?n+=o[s]:"y"===i[r]?(s&=3,s|=8,n+=o[s]):n+=i[r];return n},o.prototype._expiresIn=function(t){return this._now()+parseInt(t,10)},o.prototype._now=function(){return Math.round((new Date).getTime()/1e3)},o.prototype._addAdalFrame=function(t){if("undefined"!=typeof t){this.info("Add adal frame to document:"+t);var e=document.getElementById(t);if(!e){if(document.createElement&&document.documentElement&&(window.opera||window.navigator.userAgent.indexOf("MSIE 5.0")===-1)){var i=document.createElement("iframe");i.setAttribute("id",t),i.style.visibility="hidden",i.style.position="absolute",i.style.width=i.style.height=i.borderWidth="0px",e=document.getElementsByTagName("body")[0].appendChild(i)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+t+'" id="'+t+'" style="display:none"></iframe>');window.frames&&window.frames[t]&&(e=window.frames[t])}return e}},o.prototype._saveItem=function(t,e){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?(localStorage.setItem(t,e),!0):(this.info("Local storage is not supported"),!1):this._supportsSessionStorage()?(sessionStorage.setItem(t,e),!0):(this.info("Session storage is not supported"),!1)},o.prototype._getItem=function(t){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?localStorage.getItem(t):(this.info("Local storage is not supported"),null):this._supportsSessionStorage()?sessionStorage.getItem(t):(this.info("Session storage is not supported"),null)},o.prototype._supportsLocalStorage=function(){try{return"localStorage"in window&&window.localStorage}catch(t){return!1}},o.prototype._supportsSessionStorage=function(){try{return"sessionStorage"in window&&window.sessionStorage}catch(t){return!1}},o.prototype._cloneConfig=function(t){if(null===t||"object"!==("undefined"==typeof t?"undefined":i(t)))return t;var e={};for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e},o.prototype._addLibMetadata=function(){return"&x-client-SKU=Js&x-client-Ver="+this._libVersion()},o.prototype.log=function(t,e,i){if(t<=Logging.level){var o=(new Date).toUTCString(),s="";s=this.config.correlationId?o+":"+this.config.correlationId+"-"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[t]+" "+e:o+":"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[t]+" "+e,i&&(s+="\nstack:\n"+i.stack),Logging.log(s)}},o.prototype.error=function(t,e){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,t,e)},o.prototype.warn=function(t){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,t,null)},o.prototype.info=function(t){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,t,null)},o.prototype.verbose=function(t){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,t,null)},o.prototype._libVersion=function(){return"1.0.12"},"undefined"!=typeof t&&t.exports&&(t.exports=o,t.exports.inject=function(t){return new o(t)}),o}()}])});
//# sourceMappingURL=salte-auth.js.map