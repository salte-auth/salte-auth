/**
 * salte-auth JavaScript Library v1.0.16
 *
 * @license MIT (https://github.com/salte-io/salte-auth/blob/master/LICENSE)
 *
 * Made with â™¥ by Ceci <admin@cecilias.me>, Dave Woodward <dave@salte.io>
 */
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define("salte-auth", [], factory);
	else if(typeof exports === 'object')
		exports["salte-auth"] = factory();
	else
		root["salte-auth"] = factory();
})(this, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.l = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// identity function for calling harmony imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };

/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};

/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};

/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 6);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/* unknown exports provided */
/* all exports used */
/*!**************************************!*\
  !*** ../~/webpack/buildin/global.js ***!
  \**************************************/
/***/ (function(module, exports) {

eval("var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi9+L3dlYnBhY2svYnVpbGRpbi9nbG9iYWwuanM/NjJhNiJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZztcclxuXHJcbi8vIFRoaXMgd29ya3MgaW4gbm9uLXN0cmljdCBtb2RlXHJcbmcgPSAoZnVuY3Rpb24oKSB7XHJcblx0cmV0dXJuIHRoaXM7XHJcbn0pKCk7XHJcblxyXG50cnkge1xyXG5cdC8vIFRoaXMgd29ya3MgaWYgZXZhbCBpcyBhbGxvd2VkIChzZWUgQ1NQKVxyXG5cdGcgPSBnIHx8IEZ1bmN0aW9uKFwicmV0dXJuIHRoaXNcIikoKSB8fCAoMSxldmFsKShcInRoaXNcIik7XHJcbn0gY2F0Y2goZSkge1xyXG5cdC8vIFRoaXMgd29ya3MgaWYgdGhlIHdpbmRvdyByZWZlcmVuY2UgaXMgYXZhaWxhYmxlXHJcblx0aWYodHlwZW9mIHdpbmRvdyA9PT0gXCJvYmplY3RcIilcclxuXHRcdGcgPSB3aW5kb3c7XHJcbn1cclxuXHJcbi8vIGcgY2FuIHN0aWxsIGJlIHVuZGVmaW5lZCwgYnV0IG5vdGhpbmcgdG8gZG8gYWJvdXQgaXQuLi5cclxuLy8gV2UgcmV0dXJuIHVuZGVmaW5lZCwgaW5zdGVhZCBvZiBub3RoaW5nIGhlcmUsIHNvIGl0J3NcclxuLy8gZWFzaWVyIHRvIGhhbmRsZSB0aGlzIGNhc2UuIGlmKCFnbG9iYWwpIHsgLi4ufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBnO1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9+L3dlYnBhY2svYnVpbGRpbi9nbG9iYWwuanNcbi8vIG1vZHVsZSBpZCA9IDBcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 1 */
/* unknown exports provided */
/* all exports used */
/*!************************************!*\
  !*** ../~/uuid/lib/bytesToUuid.js ***!
  \************************************/
/***/ (function(module, exports) {

eval("/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return  bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi9+L3V1aWQvbGliL2J5dGVzVG9VdWlkLmpzPzI4ZDUiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb252ZXJ0IGFycmF5IG9mIDE2IGJ5dGUgdmFsdWVzIHRvIFVVSUQgc3RyaW5nIGZvcm1hdCBvZiB0aGUgZm9ybTpcbiAqIFhYWFhYWFhYLVhYWFgtWFhYWC1YWFhYLVhYWFgtWFhYWFhYWFhYWFhYXG4gKi9cbnZhciBieXRlVG9IZXggPSBbXTtcbmZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyArK2kpIHtcbiAgYnl0ZVRvSGV4W2ldID0gKGkgKyAweDEwMCkudG9TdHJpbmcoMTYpLnN1YnN0cigxKTtcbn1cblxuZnVuY3Rpb24gYnl0ZXNUb1V1aWQoYnVmLCBvZmZzZXQpIHtcbiAgdmFyIGkgPSBvZmZzZXQgfHwgMDtcbiAgdmFyIGJ0aCA9IGJ5dGVUb0hleDtcbiAgcmV0dXJuICBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArXG4gICAgICAgICAgYnRoW2J1ZltpKytdXSArIGJ0aFtidWZbaSsrXV0gKyAnLScgK1xuICAgICAgICAgIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICsgJy0nICtcbiAgICAgICAgICBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArICctJyArXG4gICAgICAgICAgYnRoW2J1ZltpKytdXSArIGJ0aFtidWZbaSsrXV0gKyAnLScgK1xuICAgICAgICAgIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICtcbiAgICAgICAgICBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArXG4gICAgICAgICAgYnRoW2J1ZltpKytdXSArIGJ0aFtidWZbaSsrXV07XG59XG5cbm1vZHVsZS5leHBvcnRzID0gYnl0ZXNUb1V1aWQ7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9+L3V1aWQvbGliL2J5dGVzVG9VdWlkLmpzXG4vLyBtb2R1bGUgaWQgPSAxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 2 */
/* unknown exports provided */
/* all exports used */
/*!************************************!*\
  !*** ../~/uuid/lib/rng-browser.js ***!
  \************************************/
/***/ (function(module, exports, __webpack_require__) {

eval("/* WEBPACK VAR INJECTION */(function(global) {// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\nvar rng;\n\nvar crypto = global.crypto || global.msCrypto; // for IE 11\nif (crypto && crypto.getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16);\n  rng = function whatwgRNG() {\n    crypto.getRandomValues(rnds8);\n    return rnds8;\n  };\n}\n\nif (!rng) {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var  rnds = new Array(16);\n  rng = function() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n\nmodule.exports = rng;\n\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(/*! ./../../webpack/buildin/global.js */ 0)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi9+L3V1aWQvbGliL3JuZy1icm93c2VyLmpzP2ExOWUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVW5pcXVlIElEIGNyZWF0aW9uIHJlcXVpcmVzIGEgaGlnaCBxdWFsaXR5IHJhbmRvbSAjIGdlbmVyYXRvci4gIEluIHRoZVxuLy8gYnJvd3NlciB0aGlzIGlzIGEgbGl0dGxlIGNvbXBsaWNhdGVkIGR1ZSB0byB1bmtub3duIHF1YWxpdHkgb2YgTWF0aC5yYW5kb20oKVxuLy8gYW5kIGluY29uc2lzdGVudCBzdXBwb3J0IGZvciB0aGUgYGNyeXB0b2AgQVBJLiAgV2UgZG8gdGhlIGJlc3Qgd2UgY2FuIHZpYVxuLy8gZmVhdHVyZS1kZXRlY3Rpb25cbnZhciBybmc7XG5cbnZhciBjcnlwdG8gPSBnbG9iYWwuY3J5cHRvIHx8IGdsb2JhbC5tc0NyeXB0bzsgLy8gZm9yIElFIDExXG5pZiAoY3J5cHRvICYmIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMpIHtcbiAgLy8gV0hBVFdHIGNyeXB0byBSTkcgLSBodHRwOi8vd2lraS53aGF0d2cub3JnL3dpa2kvQ3J5cHRvXG4gIHZhciBybmRzOCA9IG5ldyBVaW50OEFycmF5KDE2KTtcbiAgcm5nID0gZnVuY3Rpb24gd2hhdHdnUk5HKCkge1xuICAgIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMocm5kczgpO1xuICAgIHJldHVybiBybmRzODtcbiAgfTtcbn1cblxuaWYgKCFybmcpIHtcbiAgLy8gTWF0aC5yYW5kb20oKS1iYXNlZCAoUk5HKVxuICAvL1xuICAvLyBJZiBhbGwgZWxzZSBmYWlscywgdXNlIE1hdGgucmFuZG9tKCkuICBJdCdzIGZhc3QsIGJ1dCBpcyBvZiB1bnNwZWNpZmllZFxuICAvLyBxdWFsaXR5LlxuICB2YXIgIHJuZHMgPSBuZXcgQXJyYXkoMTYpO1xuICBybmcgPSBmdW5jdGlvbigpIHtcbiAgICBmb3IgKHZhciBpID0gMCwgcjsgaSA8IDE2OyBpKyspIHtcbiAgICAgIGlmICgoaSAmIDB4MDMpID09PSAwKSByID0gTWF0aC5yYW5kb20oKSAqIDB4MTAwMDAwMDAwO1xuICAgICAgcm5kc1tpXSA9IHIgPj4+ICgoaSAmIDB4MDMpIDw8IDMpICYgMHhmZjtcbiAgICB9XG5cbiAgICByZXR1cm4gcm5kcztcbiAgfTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBybmc7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9+L3V1aWQvbGliL3JuZy1icm93c2VyLmpzXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 3 */
/* unknown exports provided */
/* all exports used */
/*!**************************!*\
  !*** ../~/uuid/index.js ***!
  \**************************/
/***/ (function(module, exports, __webpack_require__) {

eval("var v1 = __webpack_require__(/*! ./v1 */ 4);\nvar v4 = __webpack_require__(/*! ./v4 */ 5);\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi9+L3V1aWQvaW5kZXguanM/MTg1MyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdjEgPSByZXF1aXJlKCcuL3YxJyk7XG52YXIgdjQgPSByZXF1aXJlKCcuL3Y0Jyk7XG5cbnZhciB1dWlkID0gdjQ7XG51dWlkLnYxID0gdjE7XG51dWlkLnY0ID0gdjQ7XG5cbm1vZHVsZS5leHBvcnRzID0gdXVpZDtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4uL34vdXVpZC9pbmRleC5qc1xuLy8gbW9kdWxlIGlkID0gM1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 4 */
/* unknown exports provided */
/* all exports used */
/*!***********************!*\
  !*** ../~/uuid/v1.js ***!
  \***********************/
/***/ (function(module, exports, __webpack_require__) {

eval("// Unique ID creation requires a high quality random # generator.  We feature\n// detect to determine the best RNG source, normalizing to a function that\n// returns 128-bits of randomness, since that's what's usually required\nvar rng = __webpack_require__(/*! ./lib/rng */ 2);\nvar bytesToUuid = __webpack_require__(/*! ./lib/bytesToUuid */ 1);\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\n// random #'s we need to init node and clockseq\nvar _seedBytes = rng();\n\n// Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\nvar _nodeId = [\n  _seedBytes[0] | 0x01,\n  _seedBytes[1], _seedBytes[2], _seedBytes[3], _seedBytes[4], _seedBytes[5]\n];\n\n// Per 4.2.2, randomize (14 bit) clockseq\nvar _clockseq = (_seedBytes[6] << 8 | _seedBytes[7]) & 0x3fff;\n\n// Previous uuid creation time\nvar _lastMSecs = 0, _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  var node = options.node || _nodeId;\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi9+L3V1aWQvdjEuanM/ZGUxNCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBVbmlxdWUgSUQgY3JlYXRpb24gcmVxdWlyZXMgYSBoaWdoIHF1YWxpdHkgcmFuZG9tICMgZ2VuZXJhdG9yLiAgV2UgZmVhdHVyZVxuLy8gZGV0ZWN0IHRvIGRldGVybWluZSB0aGUgYmVzdCBSTkcgc291cmNlLCBub3JtYWxpemluZyB0byBhIGZ1bmN0aW9uIHRoYXRcbi8vIHJldHVybnMgMTI4LWJpdHMgb2YgcmFuZG9tbmVzcywgc2luY2UgdGhhdCdzIHdoYXQncyB1c3VhbGx5IHJlcXVpcmVkXG52YXIgcm5nID0gcmVxdWlyZSgnLi9saWIvcm5nJyk7XG52YXIgYnl0ZXNUb1V1aWQgPSByZXF1aXJlKCcuL2xpYi9ieXRlc1RvVXVpZCcpO1xuXG4vLyAqKmB2MSgpYCAtIEdlbmVyYXRlIHRpbWUtYmFzZWQgVVVJRCoqXG4vL1xuLy8gSW5zcGlyZWQgYnkgaHR0cHM6Ly9naXRodWIuY29tL0xpb3NLL1VVSUQuanNcbi8vIGFuZCBodHRwOi8vZG9jcy5weXRob24ub3JnL2xpYnJhcnkvdXVpZC5odG1sXG5cbi8vIHJhbmRvbSAjJ3Mgd2UgbmVlZCB0byBpbml0IG5vZGUgYW5kIGNsb2Nrc2VxXG52YXIgX3NlZWRCeXRlcyA9IHJuZygpO1xuXG4vLyBQZXIgNC41LCBjcmVhdGUgYW5kIDQ4LWJpdCBub2RlIGlkLCAoNDcgcmFuZG9tIGJpdHMgKyBtdWx0aWNhc3QgYml0ID0gMSlcbnZhciBfbm9kZUlkID0gW1xuICBfc2VlZEJ5dGVzWzBdIHwgMHgwMSxcbiAgX3NlZWRCeXRlc1sxXSwgX3NlZWRCeXRlc1syXSwgX3NlZWRCeXRlc1szXSwgX3NlZWRCeXRlc1s0XSwgX3NlZWRCeXRlc1s1XVxuXTtcblxuLy8gUGVyIDQuMi4yLCByYW5kb21pemUgKDE0IGJpdCkgY2xvY2tzZXFcbnZhciBfY2xvY2tzZXEgPSAoX3NlZWRCeXRlc1s2XSA8PCA4IHwgX3NlZWRCeXRlc1s3XSkgJiAweDNmZmY7XG5cbi8vIFByZXZpb3VzIHV1aWQgY3JlYXRpb24gdGltZVxudmFyIF9sYXN0TVNlY3MgPSAwLCBfbGFzdE5TZWNzID0gMDtcblxuLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9icm9vZmEvbm9kZS11dWlkIGZvciBBUEkgZGV0YWlsc1xuZnVuY3Rpb24gdjEob3B0aW9ucywgYnVmLCBvZmZzZXQpIHtcbiAgdmFyIGkgPSBidWYgJiYgb2Zmc2V0IHx8IDA7XG4gIHZhciBiID0gYnVmIHx8IFtdO1xuXG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gIHZhciBjbG9ja3NlcSA9IG9wdGlvbnMuY2xvY2tzZXEgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuY2xvY2tzZXEgOiBfY2xvY2tzZXE7XG5cbiAgLy8gVVVJRCB0aW1lc3RhbXBzIGFyZSAxMDAgbmFuby1zZWNvbmQgdW5pdHMgc2luY2UgdGhlIEdyZWdvcmlhbiBlcG9jaCxcbiAgLy8gKDE1ODItMTAtMTUgMDA6MDApLiAgSlNOdW1iZXJzIGFyZW4ndCBwcmVjaXNlIGVub3VnaCBmb3IgdGhpcywgc29cbiAgLy8gdGltZSBpcyBoYW5kbGVkIGludGVybmFsbHkgYXMgJ21zZWNzJyAoaW50ZWdlciBtaWxsaXNlY29uZHMpIGFuZCAnbnNlY3MnXG4gIC8vICgxMDAtbmFub3NlY29uZHMgb2Zmc2V0IGZyb20gbXNlY3MpIHNpbmNlIHVuaXggZXBvY2gsIDE5NzAtMDEtMDEgMDA6MDAuXG4gIHZhciBtc2VjcyA9IG9wdGlvbnMubXNlY3MgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMubXNlY3MgOiBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcblxuICAvLyBQZXIgNC4yLjEuMiwgdXNlIGNvdW50IG9mIHV1aWQncyBnZW5lcmF0ZWQgZHVyaW5nIHRoZSBjdXJyZW50IGNsb2NrXG4gIC8vIGN5Y2xlIHRvIHNpbXVsYXRlIGhpZ2hlciByZXNvbHV0aW9uIGNsb2NrXG4gIHZhciBuc2VjcyA9IG9wdGlvbnMubnNlY3MgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMubnNlY3MgOiBfbGFzdE5TZWNzICsgMTtcblxuICAvLyBUaW1lIHNpbmNlIGxhc3QgdXVpZCBjcmVhdGlvbiAoaW4gbXNlY3MpXG4gIHZhciBkdCA9IChtc2VjcyAtIF9sYXN0TVNlY3MpICsgKG5zZWNzIC0gX2xhc3ROU2VjcykvMTAwMDA7XG5cbiAgLy8gUGVyIDQuMi4xLjIsIEJ1bXAgY2xvY2tzZXEgb24gY2xvY2sgcmVncmVzc2lvblxuICBpZiAoZHQgPCAwICYmIG9wdGlvbnMuY2xvY2tzZXEgPT09IHVuZGVmaW5lZCkge1xuICAgIGNsb2Nrc2VxID0gY2xvY2tzZXEgKyAxICYgMHgzZmZmO1xuICB9XG5cbiAgLy8gUmVzZXQgbnNlY3MgaWYgY2xvY2sgcmVncmVzc2VzIChuZXcgY2xvY2tzZXEpIG9yIHdlJ3ZlIG1vdmVkIG9udG8gYSBuZXdcbiAgLy8gdGltZSBpbnRlcnZhbFxuICBpZiAoKGR0IDwgMCB8fCBtc2VjcyA+IF9sYXN0TVNlY3MpICYmIG9wdGlvbnMubnNlY3MgPT09IHVuZGVmaW5lZCkge1xuICAgIG5zZWNzID0gMDtcbiAgfVxuXG4gIC8vIFBlciA0LjIuMS4yIFRocm93IGVycm9yIGlmIHRvbyBtYW55IHV1aWRzIGFyZSByZXF1ZXN0ZWRcbiAgaWYgKG5zZWNzID49IDEwMDAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCd1dWlkLnYxKCk6IENhblxcJ3QgY3JlYXRlIG1vcmUgdGhhbiAxME0gdXVpZHMvc2VjJyk7XG4gIH1cblxuICBfbGFzdE1TZWNzID0gbXNlY3M7XG4gIF9sYXN0TlNlY3MgPSBuc2VjcztcbiAgX2Nsb2Nrc2VxID0gY2xvY2tzZXE7XG5cbiAgLy8gUGVyIDQuMS40IC0gQ29udmVydCBmcm9tIHVuaXggZXBvY2ggdG8gR3JlZ29yaWFuIGVwb2NoXG4gIG1zZWNzICs9IDEyMjE5MjkyODAwMDAwO1xuXG4gIC8vIGB0aW1lX2xvd2BcbiAgdmFyIHRsID0gKChtc2VjcyAmIDB4ZmZmZmZmZikgKiAxMDAwMCArIG5zZWNzKSAlIDB4MTAwMDAwMDAwO1xuICBiW2krK10gPSB0bCA+Pj4gMjQgJiAweGZmO1xuICBiW2krK10gPSB0bCA+Pj4gMTYgJiAweGZmO1xuICBiW2krK10gPSB0bCA+Pj4gOCAmIDB4ZmY7XG4gIGJbaSsrXSA9IHRsICYgMHhmZjtcblxuICAvLyBgdGltZV9taWRgXG4gIHZhciB0bWggPSAobXNlY3MgLyAweDEwMDAwMDAwMCAqIDEwMDAwKSAmIDB4ZmZmZmZmZjtcbiAgYltpKytdID0gdG1oID4+PiA4ICYgMHhmZjtcbiAgYltpKytdID0gdG1oICYgMHhmZjtcblxuICAvLyBgdGltZV9oaWdoX2FuZF92ZXJzaW9uYFxuICBiW2krK10gPSB0bWggPj4+IDI0ICYgMHhmIHwgMHgxMDsgLy8gaW5jbHVkZSB2ZXJzaW9uXG4gIGJbaSsrXSA9IHRtaCA+Pj4gMTYgJiAweGZmO1xuXG4gIC8vIGBjbG9ja19zZXFfaGlfYW5kX3Jlc2VydmVkYCAoUGVyIDQuMi4yIC0gaW5jbHVkZSB2YXJpYW50KVxuICBiW2krK10gPSBjbG9ja3NlcSA+Pj4gOCB8IDB4ODA7XG5cbiAgLy8gYGNsb2NrX3NlcV9sb3dgXG4gIGJbaSsrXSA9IGNsb2Nrc2VxICYgMHhmZjtcblxuICAvLyBgbm9kZWBcbiAgdmFyIG5vZGUgPSBvcHRpb25zLm5vZGUgfHwgX25vZGVJZDtcbiAgZm9yICh2YXIgbiA9IDA7IG4gPCA2OyArK24pIHtcbiAgICBiW2kgKyBuXSA9IG5vZGVbbl07XG4gIH1cblxuICByZXR1cm4gYnVmID8gYnVmIDogYnl0ZXNUb1V1aWQoYik7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gdjE7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9+L3V1aWQvdjEuanNcbi8vIG1vZHVsZSBpZCA9IDRcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 5 */
/* unknown exports provided */
/* all exports used */
/*!***********************!*\
  !*** ../~/uuid/v4.js ***!
  \***********************/
/***/ (function(module, exports, __webpack_require__) {

eval("var rng = __webpack_require__(/*! ./lib/rng */ 2);\nvar bytesToUuid = __webpack_require__(/*! ./lib/bytesToUuid */ 1);\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options == 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi9+L3V1aWQvdjQuanM/NDJlMiJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgcm5nID0gcmVxdWlyZSgnLi9saWIvcm5nJyk7XG52YXIgYnl0ZXNUb1V1aWQgPSByZXF1aXJlKCcuL2xpYi9ieXRlc1RvVXVpZCcpO1xuXG5mdW5jdGlvbiB2NChvcHRpb25zLCBidWYsIG9mZnNldCkge1xuICB2YXIgaSA9IGJ1ZiAmJiBvZmZzZXQgfHwgMDtcblxuICBpZiAodHlwZW9mKG9wdGlvbnMpID09ICdzdHJpbmcnKSB7XG4gICAgYnVmID0gb3B0aW9ucyA9PSAnYmluYXJ5JyA/IG5ldyBBcnJheSgxNikgOiBudWxsO1xuICAgIG9wdGlvbnMgPSBudWxsO1xuICB9XG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gIHZhciBybmRzID0gb3B0aW9ucy5yYW5kb20gfHwgKG9wdGlvbnMucm5nIHx8IHJuZykoKTtcblxuICAvLyBQZXIgNC40LCBzZXQgYml0cyBmb3IgdmVyc2lvbiBhbmQgYGNsb2NrX3NlcV9oaV9hbmRfcmVzZXJ2ZWRgXG4gIHJuZHNbNl0gPSAocm5kc1s2XSAmIDB4MGYpIHwgMHg0MDtcbiAgcm5kc1s4XSA9IChybmRzWzhdICYgMHgzZikgfCAweDgwO1xuXG4gIC8vIENvcHkgYnl0ZXMgdG8gYnVmZmVyLCBpZiBwcm92aWRlZFxuICBpZiAoYnVmKSB7XG4gICAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IDE2OyArK2lpKSB7XG4gICAgICBidWZbaSArIGlpXSA9IHJuZHNbaWldO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBidWYgfHwgYnl0ZXNUb1V1aWQocm5kcyk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gdjQ7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9+L3V1aWQvdjQuanNcbi8vIG1vZHVsZSBpZCA9IDVcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 6 */
/* unknown exports provided */
/* all exports used */
/*!***********************!*\
  !*** ./salte-auth.js ***!
  \***********************/
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("/* WEBPACK VAR INJECTION */(function(global) {\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @public\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @class Config\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {string} url                 Required.  This is the base url for the identity provider's authorize and token endpoint; not including the word authorize or token.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {string} extraQueryParameter Optional.  Value to be included as an additional query parameter when calling the identity provider's authorize and token endpoints.  Should be formatted as \"name=value\".\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {string} responseType        Optional; defaults to id_token.  OAuth 2.0 Response Type value that determines the authorization processing flow to be used, including what parameters are returned from the endpoints used.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {string} clientId            Required.  OAuth 2.0 Client Identifier valid at the Authorization Server.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {string} scope               Optional.  This may be used to define the specific authorization(s) being requested from the resource owner.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {string} redirectUri         Optional; defaults to current window location.  Redirection URI to which the response will be sent. This URI MUST exactly match one of the Redirection URI values for the Client pre-registered at the OpenID Provider.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {string} loginResource       Optional; defaults to clientId.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {object} securedEndpoints    Optional.  Object containing one or more named endpoints (e.g. { \"Endpoint\": \"ResourceId\" }).  This list is used to identify endpoints to which tokens should be attached.  If \"Endpoint\" exists anywhere within the endpoint being called then it is considered to be a match.  If the endpoint being called doesn't match then either no token will be passed or, if the endpoint's hostname matches the application hostname, then the id_token will be passed.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {Array} anonymousEndpoints   Optional.  Array containing one or more endpoints to which a token need not be attached.  If the endpoint specified exists anywhere within the endpoint being called then it is considered to be a match.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {boolean} isAngular          Optional.  Used to tell this library whether it should handle the callback from the authorization server itself or bubble the response up to the main window's URL and let the Angular http interceptor handle it.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {function} displayCall       Optional.  If specified then this function will be called with the fully-formed authorization url when login is invoked.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {boolean} popUp              Optional; defaults to true.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {function} callback          Optional.  If specified then this function will be called upon receiving a successful response or error from the authorization server.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {string} hashPrefix          Optional; defaults to empty string.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @property {string} tokenCallbackTimeout Optional; defaults to 6 seconds.  This is the amount of time salte-auth will wait for the identity provider's token endpoint to respond.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */\n\n/**\n * User information from idtoken.\n *  @class User\n *  @property {string} userName - username assigned from upn, email, or sub (i.e. subject).\n *  @property {object} profile - properties parsed from idtoken.\n */\n\nvar _uuid = __webpack_require__(/*! uuid */ 3);\n\nvar _uuid2 = _interopRequireDefault(_uuid);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar AuthenticationContext = function () {\n  /**\n   * Creates a new AuthenticationContext object.\n   * @constructor\n   * @param {object}  config               Configuration options for AuthenticationContext\n   */\n  function AuthenticationContext(config) {\n    _classCallCheck(this, AuthenticationContext);\n\n    /**\n    * Enum for request type\n    * @enum {string}\n    */\n    this.REQUEST_TYPE = {\n      LOGIN: 'LOGIN',\n      RENEW_TOKEN: 'RENEW_TOKEN',\n      UNKNOWN: 'UNKNOWN'\n    };\n\n    /**\n    * Enum for storage constants\n    * @enum {string}\n    */\n    this.CONSTANTS = {\n      ACCESS_TOKEN: 'access_token',\n      EXPIRES_IN: 'expires_in',\n      ID_TOKEN: 'id_token',\n      ERROR_DESCRIPTION: 'error_description',\n      SESSION_STATE: 'session_state',\n      STORAGE: {\n        TOKEN_KEYS: 'auth.token.keys',\n        ACCESS_TOKEN_KEY: 'auth.access.token.key',\n        EXPIRATION_KEY: 'auth.expiration.key',\n        STATE_LOGIN: 'auth.state.login',\n        STATE_RENEW: 'auth.state.renew',\n        NONCE_IDTOKEN: 'auth.nonce.idtoken',\n        SESSION_STATE: 'auth.session.state',\n        USERNAME: 'auth.username',\n        IDTOKEN: 'auth.idtoken',\n        ERROR: 'auth.error',\n        ERROR_DESCRIPTION: 'auth.error.description',\n        LOGIN_REQUEST: 'auth.login.request',\n        LOGIN_ERROR: 'auth.login.error',\n        RENEW_STATUS: 'auth.token.renew.status'\n      },\n      RESOURCE_DELIMETER: '|',\n      LOADFRAME_TIMEOUT: '6000',\n      TOKEN_RENEW_STATUS_CANCELED: 'Canceled',\n      TOKEN_RENEW_STATUS_COMPLETED: 'Completed',\n      TOKEN_RENEW_STATUS_IN_PROGRESS: 'In Progress',\n      LOGGING_LEVEL: {\n        ERROR: 0,\n        WARN: 1,\n        INFO: 2,\n        VERBOSE: 3\n      },\n      LEVEL_STRING_MAP: {\n        0: 'ERROR:',\n        1: 'WARNING:',\n        2: 'INFO:',\n        3: 'VERBOSE:'\n      },\n      POPUP_WIDTH: 483,\n      POPUP_HEIGHT: 600\n    };\n\n    if (window.AuthenticationContext) {\n      return window.AuthenticationContext;\n    }\n    window.AuthenticationContext = this;\n\n    // public\n    this.config = {};\n    this.callback = null;\n    this.popUp = false;\n    this.isAngular = false;\n\n    // private\n    this._user = null;\n    this._activeRenewals = {};\n    this._loginInProgress = false;\n    this._renewStates = [];\n\n    this.callBackMappedToRenewStates = {};\n    this.callBacksMappedToRenewStates = {};\n\n    // validate before constructor assignments\n    if (config.displayCall && typeof config.displayCall !== 'function') {\n      throw new Error('displayCall is not a function');\n    }\n\n    if (!config.clientId) {\n      throw new Error('clientId is required');\n    }\n\n    if (!config.url || !config.url.match(/^https:\\/\\/.*\\/$/)) {\n      throw new Error('url must be a valid https endpoint that ends in a forward slash.');\n    }\n\n    this.config = this._cloneConfig(config);\n\n    if (this.config.popUp) {\n      this.popUp = true;\n    }\n\n    if (this.config.callback && typeof this.config.callback === 'function') {\n      this.callback = this.config.callback;\n    }\n\n    // App can request idtoken for itself using clientid as resource\n    if (!this.config.loginResource) {\n      this.config.loginResource = this.config.clientId;\n    }\n\n    if (!this.config.redirectUri) {\n      this.config.redirectUri = window.location.href;\n    }\n\n    if (!this.config.anonymousEndpoints) {\n      this.config.anonymousEndpoints = [];\n    }\n\n    if (this.config.isAngular) {\n      this.isAngular = this.config.isAngular;\n    }\n\n    this.setResponseType(this.config.responseType);\n\n    if (this._isEmpty(this.config.hashPrefix)) {\n      this.config.hashPrefix = '';\n    }\n\n    if (this._isEmpty(this.config.tokenCallbackTimeout)) {\n      this.config.tokenCallbackTimeout = this.CONSTANTS.LOADFRAME_TIMEOUT;\n    }\n  }\n\n  _createClass(AuthenticationContext, [{\n    key: 'setResponseType',\n    value: function setResponseType(responseType) {\n      this.config.responseType = responseType || this.CONSTANTS.ID_TOKEN;\n    }\n\n    /**\n     * Gets initial Idtoken for the app backend\n     * Saves the resulting Idtoken in localStorage.\n     * @param {string} startPage the start page\n     */\n\n  }, {\n    key: 'login',\n    value: function login(startPage) {\n      // Token is not present and user needs to login\n      if (this._loginInProgress) {\n        this.info('Login in progress');\n        return;\n      }\n      var expectedState = _uuid2.default.v4();\n      this.config.state = expectedState;\n      this._idTokenNonce = _uuid2.default.v4();\n      if (!startPage) {\n        startPage = window.location;\n      }\n      this.verbose('Expected state: ' + expectedState + ' startPage:' + startPage);\n      this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST, startPage);\n      this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR, '');\n      this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN, expectedState);\n      this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN, this._idTokenNonce);\n      this._saveItem(this.CONSTANTS.STORAGE.ERROR, '');\n      this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION, '');\n      var urlNavigate = this._getNavigateUrl(this.config.responseType, null) + '&nonce=' + encodeURIComponent(this._idTokenNonce);\n      this._loginInProgress = true;\n      if (this.popUp) {\n        this._loginPopup(urlNavigate);\n        return;\n      }\n      if (this.config.displayCall) {\n        // User defined way of handling the navigation\n        this.config.displayCall(urlNavigate);\n      } else {\n        this.promptUser(urlNavigate);\n      }\n    }\n  }, {\n    key: '_openPopup',\n    value: function _openPopup(urlNavigate, title, popUpWidth, popUpHeight) {\n      try {\n        /**\n        * adding winLeft and winTop to account for dual monitor\n        * using screenLeft and screenTop for IE8 and earlier\n        */\n        var winLeft = window.screenLeft ? window.screenLeft : window.screenX;\n        var winTop = window.screenTop ? window.screenTop : window.screenY;\n        /**\n        * window.innerWidth displays browser window's height and width excluding toolbars\n        * using document.documentElement.clientWidth for IE8 and earlier\n        */\n        var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\n        var height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\n        var left = width / 2 - popUpWidth / 2 + winLeft;\n        var top = height / 2 - popUpHeight / 2 + winTop;\n\n        var popupWindow = this.open(urlNavigate, title, 'width=' + popUpWidth + ', height=' + popUpHeight + ', top=' + top + ', left=' + left);\n        if (popupWindow.focus) {\n          popupWindow.focus();\n        }\n        return popupWindow;\n      } catch (e) {\n        this.warn('Error opening popup, ' + e.message);\n        this._loginInProgress = false;\n        return null;\n      }\n    }\n  }, {\n    key: '_loginPopup',\n    value: function _loginPopup(urlNavigate) {\n      var _this = this;\n\n      var popupWindow = this._openPopup(urlNavigate, 'login', this.CONSTANTS.POPUP_WIDTH, this.CONSTANTS.POPUP_HEIGHT);\n      if (popupWindow === null) {\n        this.warn('Popup Window is null. This can happen if you are using IE');\n        this._saveItem(this.CONSTANTS.STORAGE.ERROR, 'Error opening popup');\n        this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION, 'Popup Window is null. This can happen if you are using IE');\n        this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR, 'Popup Window is null. This can happen if you are using IE');\n        if (this.callback) {\n          this.callback(this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR), null);\n        }\n        return;\n      }\n      var registeredRedirectUri = void 0;\n      if (this.config.redirectUri.indexOf('#') === -1) {\n        registeredRedirectUri = this.config.redirectUri;\n      } else {\n        registeredRedirectUri = this.config.redirectUri.split('#')[0];\n      }\n      var pollTimer = window.setInterval(function () {\n        if (!popupWindow || popupWindow.closed || popupWindow.closed === undefined) {\n          _this._loginInProgress = false;\n          window.clearInterval(pollTimer);\n        }\n        try {\n          if (popupWindow.location.href.indexOf(registeredRedirectUri) !== -1) {\n            if (_this.isAngular) {\n              window.location.hash = popupWindow.location.hash;\n            } else {\n              _this.handleWindowCallback(popupWindow.location.hash, popupWindow.location.search);\n            }\n            window.clearInterval(pollTimer);\n            _this._loginInProgress = false;\n            _this.info('Closing popup window');\n            popupWindow.close();\n          }\n        } catch (e) {}\n      }, 20);\n    }\n  }, {\n    key: 'loginInProgress',\n    value: function loginInProgress() {\n      return this._loginInProgress;\n    }\n  }, {\n    key: '_hasResource',\n    value: function _hasResource(key) {\n      var keys = this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);\n      return keys && !this._isEmpty(keys) && keys.indexOf(key + this.CONSTANTS.RESOURCE_DELIMETER) > -1;\n    }\n\n    /**\n     * Gets token for the specified resource from local storage cache\n     * @param {string}   resource A URI that identifies the resource for which the token is valid.\n     * @return {string} token if exists and not expired or null\n     */\n\n  }, {\n    key: 'getCachedToken',\n    value: function getCachedToken(resource) {\n      if (!this._hasResource(resource)) {\n        return null;\n      }\n\n      var token = this._getItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY + resource);\n      var expired = this._getItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY + resource);\n\n      // If expiration is within offset, it will force renew\n      var offset = this.config.expireOffsetSeconds || 120;\n\n      if (expired && expired > this._now() + offset) {\n        return token;\n      }\n      this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY + resource, '');\n      this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY + resource, 0);\n      return null;\n    }\n\n    /**\n     * Retrieves and parse idToken from localstorage\n     * @return {User} user object\n     */\n\n  }, {\n    key: 'getCachedUser',\n    value: function getCachedUser() {\n      if (this._user) {\n        return this._user;\n      }\n\n      var idtoken = this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);\n      this._user = this._createUser(idtoken);\n      return this._user;\n    }\n  }, {\n    key: 'registerCallback',\n    value: function registerCallback(expectedState, resource, callback) {\n      var _this2 = this;\n\n      this._activeRenewals[resource] = expectedState;\n      if (!this.callBacksMappedToRenewStates[expectedState]) {\n        this.callBacksMappedToRenewStates[expectedState] = [];\n      }\n      this.callBacksMappedToRenewStates[expectedState].push(callback);\n      if (!this.callBackMappedToRenewStates[expectedState]) {\n        this.callBackMappedToRenewStates[expectedState] = function (message, token) {\n          for (var i = 0; i < _this2.callBacksMappedToRenewStates[expectedState].length; ++i) {\n            try {\n              _this2.callBacksMappedToRenewStates[expectedState][i](message, token);\n            } catch (error) {\n              _this2.warn(error);\n            }\n          }\n          _this2._activeRenewals[resource] = null;\n          _this2.callBacksMappedToRenewStates[expectedState] = null;\n          _this2.callBackMappedToRenewStates[expectedState] = null;\n        };\n      }\n    }\n\n    /**\n     * Acquires access token with hidden iframe\n     * @param {string} resource  ResourceUri identifying the target resource\n     * @param {string} callback  ResourceUri identifying the target resource\n     */\n\n  }, {\n    key: '_renewToken',\n    value: function _renewToken(resource, callback) {\n      // use iframe to try refresh token\n      // use given resource to create new authz url\n      this.info('renewToken is called for resource:' + resource);\n      var frameHandle = this._addAuthFrame('authRenewFrame' + resource);\n      var expectedState = _uuid2.default.v4() + '|' + resource;\n      this.config.state = expectedState;\n      // renew happens in iframe, so it keeps javascript context\n      this._renewStates.push(expectedState);\n\n      this.verbose('Renew token Expected state: ' + expectedState);\n      var urlNavigate = this._getNavigateUrl('token', resource) + '&prompt=none';\n      urlNavigate = this._addHintParameters(urlNavigate);\n\n      this.registerCallback(expectedState, resource, callback);\n      this.verbose('Navigate to:' + urlNavigate);\n      this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST, '');\n      frameHandle.src = 'about:blank';\n      this._loadFrameTimeout(urlNavigate, 'authRenewFrame' + resource, resource);\n    }\n  }, {\n    key: '_renewIdToken',\n    value: function _renewIdToken(callback) {\n      // use iframe to try refresh token\n      this.info('renewIdToken is called');\n      var frameHandle = this._addAuthFrame('authIdTokenFrame');\n      var expectedState = _uuid2.default.v4() + '|' + this.config.clientId;\n      this._idTokenNonce = _uuid2.default.v4();\n      this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN, this._idTokenNonce);\n      this.config.state = expectedState;\n      // renew happens in iframe, so it keeps javascript context\n      this._renewStates.push(expectedState);\n\n      this.verbose('Renew Idtoken Expected state: ' + expectedState);\n      var urlNavigate = this._getNavigateUrl(this.config.responseType, null) + '&prompt=none';\n      urlNavigate = this._addHintParameters(urlNavigate);\n\n      urlNavigate += '&nonce=' + encodeURIComponent(this._idTokenNonce);\n      this.registerCallback(expectedState, this.config.clientId, callback);\n      this.idTokenNonce = null;\n      this.verbose('Navigate to:' + urlNavigate);\n      this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST, '');\n      frameHandle.src = 'about:blank';\n      this._loadFrameTimeout(urlNavigate, 'authIdTokenFrame', this.config.clientId);\n    }\n  }, {\n    key: '_urlContainsQueryStringParameter',\n    value: function _urlContainsQueryStringParameter(name, url) {\n      // regex to detect pattern of a ? or & followed by the name parameter and an equals character\n      var regex = new RegExp('[\\\\?&]' + name + '=');\n      return regex.test(url);\n    }\n\n    // Calling _loadFrame but with a timeout to signal failure in loadframeStatus. Callbacks are left\n    // registered when network errors occur and subsequent token requests for same resource are registered to the pending request\n\n  }, {\n    key: '_loadFrameTimeout',\n    value: function _loadFrameTimeout(urlNavigation, frameName, resource) {\n      var _this3 = this;\n\n      // set iframe session to pending\n      this.verbose('Set loading state to pending for: ' + resource);\n      this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS + resource, this.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS);\n      this._loadFrame(urlNavigation, frameName);\n      setTimeout(function () {\n        if (_this3._getItem(_this3.CONSTANTS.STORAGE.RENEW_STATUS + resource) === _this3.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS) {\n          // fail the iframe session if it's in pending state\n          _this3.verbose('Loading frame has timed out after: ' + _this3.config.tokenCallbackTimeout / 1000 + ' seconds for resource ' + resource);\n          var expectedState = _this3._activeRenewals[resource];\n\n          _this3._saveItem(_this3.CONSTANTS.STORAGE.RENEW_STATUS + resource, _this3.CONSTANTS.TOKEN_RENEW_STATUS_CANCELED);\n\n          if (expectedState && _this3.callBackMappedToRenewStates[expectedState]) {\n            _this3.callBackMappedToRenewStates[expectedState]('Token renewal operation failed due to timeout', null);\n          }\n        }\n      }, this.config.tokenCallbackTimeout);\n    }\n  }, {\n    key: '_loadFrame',\n    value: function _loadFrame(urlNavigate, frameName) {\n      var _this4 = this;\n\n      // This trick overcomes iframe navigation in IE\n      // IE does not load the page consistently in iframe\n      this.info('LoadFrame: ' + frameName);\n      var frameCheck = frameName;\n      setTimeout(function () {\n        var frameHandle = _this4._addAuthFrame(frameCheck);\n        if (frameHandle.src === '' || frameHandle.src === 'about:blank') {\n          frameHandle.src = urlNavigate;\n          _this4._loadFrame(urlNavigate, frameCheck);\n        }\n      }, 500);\n    }\n\n    /**\n     * Acquire token from cache if not expired and available. Acquires token from iframe if expired.\n     * @param {string} resource  ResourceUri identifying the target resource\n     * @param {function} callback The callback function\n     */\n\n  }, {\n    key: 'acquireToken',\n    value: function acquireToken(resource, callback) {\n      if (this._isEmpty(resource)) {\n        this.warn('resource is required');\n        callback('resource is required', null);\n        return;\n      }\n\n      var token = this.getCachedToken(resource);\n      if (token) {\n        this.info('Token is already in cache for resource:' + resource);\n        callback(null, token);\n        return;\n      }\n\n      if (!this._user) {\n        this.warn('User login is required');\n        callback('User login is required', null);\n        return;\n      }\n\n      // refresh attept with iframe\n      // Already renewing for this resource, callback when we get the token.\n      if (this._activeRenewals[resource]) {\n        // Active renewals contains the state for each renewal.\n        this.registerCallback(this._activeRenewals[resource], resource, callback);\n      } else if (resource === this.config.clientId) {\n        // App uses idtoken to send to api endpoints\n        // Default resource is tracked as clientid to store this token\n        this.verbose('renewing idtoken');\n        this._renewIdToken(callback);\n      } else {\n        this._renewToken(resource, callback);\n      }\n    }\n\n    /**\n     * Redirect the Browser to Azure AD Authorization endpoint\n     * @param {string} urlNavigate The authorization request url\n     */\n\n  }, {\n    key: 'promptUser',\n    value: function promptUser(urlNavigate) {\n      if (urlNavigate) {\n        this.info('Navigate to:' + urlNavigate);\n        this.navigate(urlNavigate);\n      } else {\n        this.info('Navigate url is empty');\n      }\n    }\n\n    /**\n     * Clear cache items.\n     */\n\n  }, {\n    key: 'clearCache',\n    value: function clearCache() {\n      this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY, '');\n      this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY, 0);\n      this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE, '');\n      this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN, '');\n      this._renewStates = [];\n      this._saveItem(this.CONSTANTS.STORAGE.USERNAME, '');\n      this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN, '');\n      this._saveItem(this.CONSTANTS.STORAGE.ERROR, '');\n      this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION, '');\n      var keys = this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);\n\n      if (!this._isEmpty(keys)) {\n        keys = keys.split(this.CONSTANTS.RESOURCE_DELIMETER);\n        for (var i = 0; i < keys.length; i++) {\n          this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY + keys[i], '');\n          this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY + keys[i], 0);\n        }\n      }\n      this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS, '');\n    }\n\n    /**\n     * Clear cache items for a resource.\n     * @param {string} resource The resource\n     */\n\n  }, {\n    key: 'clearCacheForResource',\n    value: function clearCacheForResource(resource) {\n      this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW, '');\n      this._saveItem(this.CONSTANTS.STORAGE.ERROR, '');\n      this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION, '');\n      if (this._hasResource(resource)) {\n        this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY + resource, '');\n        this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY + resource, 0);\n      }\n    }\n\n    /**\n     * Logout user will redirect page to logout endpoint.\n     * After logout, it will redirect to post_logout page if provided.\n     */\n\n  }, {\n    key: 'logOut',\n    value: function logOut() {\n      this.clearCache();\n      var logout = '';\n      this._user = null;\n\n      if (this.config.postLogoutRedirectUri) {\n        logout = 'post_logout_redirect_uri=' + encodeURIComponent(this.config.postLogoutRedirectUri);\n      }\n\n      var urlNavigate = this.config.url + 'logout?' + logout;\n      this.info('Logout navigate to: ' + urlNavigate);\n      this.promptUser(urlNavigate);\n    }\n  }, {\n    key: '_isEmpty',\n    value: function _isEmpty(str) {\n      return typeof str === 'undefined' || !str || str.length === 0;\n    }\n\n    /**\n     * Gets a user profile\n     * @param {requestCallback} callback The callback that handles the response.\n     */\n\n  }, {\n    key: 'getUser',\n    value: function getUser(callback) {\n      // IDToken is first call\n      if (typeof callback !== 'function') {\n        throw new Error('callback is not a function');\n      }\n\n      // user in memory\n      if (this._user) {\n        callback(null, this._user);\n        return;\n      }\n\n      // frame is used to get idtoken\n      var idtoken = this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);\n      if (this._isEmpty(idtoken)) {\n        this.warn('User information is not available');\n        callback('User information is not available');\n      } else {\n        this.info('User exists in cache: ');\n        this._user = this._createUser(idtoken);\n        callback(null, this._user);\n      }\n    }\n  }, {\n    key: '_addHintParameters',\n    value: function _addHintParameters(urlNavigate) {\n      // include hint params only if upn is present\n      if (this._user && this._user.profile && this._user.profile.hasOwnProperty('upn')) {\n        // add login_hint\n        urlNavigate += '&login_hint=' + encodeURIComponent(this._user.profile.upn);\n\n        // don't add domain_hint twice if user provided it in the extraQueryParameter value\n        if (!this._urlContainsQueryStringParameter('domain_hint', urlNavigate) && this._user.profile.upn.indexOf('@') > -1) {\n          var parts = this._user.profile.upn.split('@');\n          // local part can include @ in quotes. Sending last part handles that.\n          urlNavigate += '&domain_hint=' + encodeURIComponent(parts[parts.length - 1]);\n        }\n      }\n\n      return urlNavigate;\n    }\n  }, {\n    key: '_createUser',\n    value: function _createUser(idToken) {\n      var user = null;\n      var parsedJson = this._extractIdToken(idToken);\n      if (parsedJson && parsedJson.hasOwnProperty('aud')) {\n        var audienceMatch = false;\n\n        if (Array.isArray(parsedJson.aud)) {\n          // If the ID Token contains multiple audiences then an azp claim must be present and equal to the client id.\n          if (parsedJson.hasOwnProperty('azp') && parsedJson.azp.toLowerCase() === this.config.clientId.toLowerCase()) {\n            for (var i = 0; i < parsedJson.aud.length; i++) {\n              if (parsedJson.aud[i].toLowerCase() === this.config.clientId.toLowerCase()) {\n                audienceMatch = true;\n                break;\n              }\n            }\n          }\n        } else {\n          audienceMatch = parsedJson.aud.toLowerCase() === this.config.clientId.toLowerCase();\n        }\n\n        if (audienceMatch) {\n          user = {\n            userName: '',\n            profile: parsedJson\n          };\n\n          if (parsedJson.hasOwnProperty('upn')) {\n            user.userName = parsedJson.upn;\n          } else if (parsedJson.hasOwnProperty('email')) {\n            user.userName = parsedJson.email;\n          } else if (parsedJson.hasOwnProperty('sub')) {\n            user.userName = parsedJson.sub;\n          }\n        } else {\n          this.warn('IdToken has invalid aud/azp field');\n        }\n      }\n\n      return user;\n    }\n  }, {\n    key: '_getHash',\n    value: function _getHash(hash) {\n      var marker = '#' + this.config.hashPrefix + '/';\n      hash = hash.lastIndexOf(marker) > -1 ? hash.substring(hash.lastIndexOf(marker) + this.config.hashPrefix.length + 2) : hash;\n      hash = hash.lastIndexOf('#/') > -1 ? hash.substring(hash.lastIndexOf('#/') + 2) : hash;\n      hash = hash.lastIndexOf('#') > -1 ? hash.substring(hash.lastIndexOf('#') + 1) : hash;\n\n      return hash;\n    }\n  }, {\n    key: '_getSearch',\n    value: function _getSearch(search) {\n      var index = search.indexOf('?');\n      if (index > -1) {\n        search = search.substring(index + 1);\n      }\n\n      return search;\n    }\n  }, {\n    key: '_getParameters',\n    value: function _getParameters(hash, search) {\n      var parameters = {};\n\n      if (hash) {\n        hash = this._getHash(hash);\n        parameters = this._deserialize(hash);\n      }\n\n      if (search) {\n        search = this._getSearch(search);\n        var searchParameters = this._deserialize(search);\n        parameters = this._extend(parameters, searchParameters);\n      }\n\n      return parameters;\n    }\n  }, {\n    key: '_extend',\n    value: function _extend(obj, src) {\n      for (var key in src) {\n        if (src.hasOwnProperty(key)) {\n          obj[key] = src[key];\n        }\n      }\n      return obj;\n    }\n\n    /**\n     * Checks if hash contains access token or id token or error_description\n     * @param {string} hash  -  Hash passed from redirect page\n     * @param {string} search  -  Search passed from redirect page\n     * @return {boolean} exists if all the parameters exist\n     */\n\n  }, {\n    key: 'isCallback',\n    value: function isCallback(hash, search) {\n      var parameters = this._getParameters(hash, search);\n\n      return parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION) || parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN) || parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN);\n    }\n\n    /**\n     * Gets login error\n     * @return {string} error message related to login\n     */\n\n  }, {\n    key: 'getLoginError',\n    value: function getLoginError() {\n      return this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR);\n    }\n\n    /**\n     * Gets requestInfo from given hash.\n     * @param {string} hash  -  Hash passed from redirect page\n     * @param {string} search  -  Search passed from redirect page\n     * @return {string} error message related to login\n     */\n\n  }, {\n    key: 'getRequestInfo',\n    value: function getRequestInfo(hash, search) {\n      var parameters = this._getParameters(hash, search);\n      var requestInfo = {\n        valid: false,\n        parameters: {},\n        stateMatch: false,\n        stateResponse: '',\n        requestType: this.REQUEST_TYPE.UNKNOWN\n      };\n\n      if (parameters) {\n        requestInfo.parameters = parameters;\n        if (parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION) || parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN) || parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)) {\n          requestInfo.valid = true;\n\n          // which call\n          var stateResponse = '';\n          if (parameters.hasOwnProperty('state')) {\n            this.verbose('State: ' + parameters.state);\n            stateResponse = parameters.state;\n          } else {\n            this.warn('No state returned');\n            return requestInfo;\n          }\n\n          requestInfo.stateResponse = stateResponse;\n\n          // async calls can fire iframe and login request at the same time if developer does not use the API as expected\n          // incoming callback needs to be looked up to find the request type\n          if (stateResponse === this._getItem(this.CONSTANTS.STORAGE.STATE_LOGIN)) {\n            requestInfo.requestType = this.REQUEST_TYPE.LOGIN;\n            requestInfo.stateMatch = true;\n            return requestInfo;\n          }\n\n          // external api requests may have many renewtoken requests for different resource\n          if (!requestInfo.stateMatch && window.parent && window.parent.AuthenticationContext) {\n            var statesInParentContext = window.parent.AuthenticationContext._renewStates;\n            for (var i = 0; i < statesInParentContext.length; i++) {\n              if (statesInParentContext[i] === requestInfo.stateResponse) {\n                requestInfo.requestType = this.REQUEST_TYPE.RENEW_TOKEN;\n                requestInfo.stateMatch = true;\n                break;\n              }\n            }\n          }\n        }\n      }\n\n      return requestInfo;\n    }\n  }, {\n    key: '_getResourceFromState',\n    value: function _getResourceFromState(state) {\n      if (state) {\n        var splitIndex = state.indexOf('|');\n        if (splitIndex > -1 && splitIndex + 1 < state.length) {\n          return state.substring(splitIndex + 1);\n        }\n      }\n\n      return '';\n    }\n\n    /**\n     * Saves token from hash that is received from redirect.\n     * @param {string} requestInfo Hash passed from redirect page\n     */\n\n  }, {\n    key: 'saveTokenFromHash',\n    value: function saveTokenFromHash(requestInfo) {\n      this.info('State status:' + requestInfo.stateMatch + '; Request type:' + requestInfo.requestType);\n      this._saveItem(this.CONSTANTS.STORAGE.ERROR, '');\n      this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION, '');\n\n      var resource = this._getResourceFromState(requestInfo.stateResponse);\n\n      // Record error\n      if (requestInfo.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)) {\n        this.info('Error :' + requestInfo.parameters.error + '; Error description:' + requestInfo.parameters[this.CONSTANTS.ERROR_DESCRIPTION]);\n        this._saveItem(this.CONSTANTS.STORAGE.ERROR, requestInfo.parameters.error);\n        this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION, requestInfo.parameters[this.CONSTANTS.ERROR_DESCRIPTION]);\n\n        if (requestInfo.requestType === this.REQUEST_TYPE.LOGIN) {\n          this._loginInProgress = false;\n          this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR, requestInfo.parameters.error_description);\n        }\n      } else if (requestInfo.stateMatch) {\n        // record tokens to storage if exists\n        this.info('State is right');\n        if (requestInfo.parameters.hasOwnProperty(this.CONSTANTS.SESSION_STATE)) {\n          this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE, requestInfo.parameters[this.CONSTANTS.SESSION_STATE]);\n        }\n\n        var keys = void 0;\n\n        if (requestInfo.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)) {\n          this.info('Fragment has access token');\n\n          if (!this._hasResource(resource)) {\n            keys = this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS) || '';\n            this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS, keys + resource + this.CONSTANTS.RESOURCE_DELIMETER);\n          }\n          // save token with related resource\n          this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY + resource, requestInfo.parameters[this.CONSTANTS.ACCESS_TOKEN]);\n          this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY + resource, this._expiresIn(requestInfo.parameters[this.CONSTANTS.EXPIRES_IN]));\n        }\n\n        if (requestInfo.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)) {\n          this.info('Fragment has id token');\n          this._loginInProgress = false;\n\n          this._user = this._createUser(requestInfo.parameters[this.CONSTANTS.ID_TOKEN]);\n\n          if (this._user && this._user.profile) {\n            if (this._user.profile.nonce === this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN)) {\n              this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN, requestInfo.parameters[this.CONSTANTS.ID_TOKEN]);\n\n              // Save idtoken as access token for app itself\n              resource = this.config.loginResource ? this.config.loginResource : this.config.clientId;\n\n              if (!this._hasResource(resource)) {\n                keys = this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS) || '';\n                this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS, keys + resource + this.CONSTANTS.RESOURCE_DELIMETER);\n              }\n              this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY + resource, requestInfo.parameters[this.CONSTANTS.ID_TOKEN]);\n              this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY + resource, this._user.profile.exp);\n            } else {\n              this._user = null;\n              this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR, 'Nonce is not same as ' + this._idTokenNonce);\n            }\n          } else {\n            this._saveItem(this.CONSTANTS.STORAGE.ERROR, 'invalid id_token');\n            this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION, 'Invalid id_token. id_token: ' + requestInfo.parameters[this.CONSTANTS.ID_TOKEN]);\n          }\n        }\n      } else {\n        this._saveItem(this.CONSTANTS.STORAGE.ERROR, 'Invalid_state');\n        this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION, 'Invalid_state. state: ' + requestInfo.stateResponse);\n      }\n      this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS + resource, this.CONSTANTS.TOKEN_RENEW_STATUS_COMPLETED);\n    }\n\n    /**\n     * Gets resource for given endpoint if mapping is provided with config.\n     * @param {string} endpoint API endpoint\n     * @return {string} resource for this API endpoint\n     */\n\n  }, {\n    key: 'getResourceForEndpoint',\n    value: function getResourceForEndpoint(endpoint) {\n      if (this.config && this.config.securedEndpoints) {\n        for (var configEndpoint in this.config.securedEndpoints) {\n          // configEndpoint is like /api/Todo requested endpoint can be /api/Todo/1\n          if (endpoint.indexOf(configEndpoint) > -1) {\n            return this.config.securedEndpoints[configEndpoint];\n          }\n        }\n      }\n\n      // default resource will be clientid if nothing specified\n      // App will use idtoken for calls to itself\n      // check if it's staring from http or https, needs to match with app host\n      if (endpoint.indexOf('http://') > -1 || endpoint.indexOf('https://') > -1) {\n        if (this._getHostFromUri(endpoint) === this._getHostFromUri(this.config.redirectUri)) {\n          return this.config.loginResource;\n        }\n      } else {\n        // in angular level, the url for $http interceptor call could be relative url,\n        // if it's relative call, we'll treat it as app backend call.\n        // if user specified list of anonymous endpoints, no need to send token to these endpoints, return null.\n        if (this.config && this.config.anonymousEndpoints) {\n          for (var i = 0; i < this.config.anonymousEndpoints.length; i++) {\n            if (endpoint.indexOf(this.config.anonymousEndpoints[i]) > -1) {\n              return null;\n            }\n          }\n        }\n        // all other app's backend calls are secured.\n        return this.config.loginResource;\n      }\n\n      // if not the app's own backend or not a domain listed in the endpoints structure\n      return null;\n    }\n  }, {\n    key: '_getHostFromUri',\n    value: function _getHostFromUri(uri) {\n      // remove http:// or https:// from uri\n      var extractedUri = String(uri).replace(/^(https?:)\\/\\//, '');\n\n      extractedUri = extractedUri.split('/')[0];\n      return extractedUri;\n    }\n\n    /* exported  oauth2Callback */\n\n  }, {\n    key: 'handleWindowCallback',\n    value: function handleWindowCallback(hash, search) {\n      // This is for regular javascript usage for redirect handling\n      // need to make sure this is for callback\n      if (!hash) {\n        hash = window.location.hash;\n      }\n\n      if (!search) {\n        search = window.location.search;\n      }\n\n      if (this.isCallback(hash, search)) {\n        var requestInfo = this.getRequestInfo(hash, search);\n        this.info('Returned from redirect url');\n        this.saveTokenFromHash(requestInfo);\n        var callback = null;\n        if (requestInfo.requestType === this.REQUEST_TYPE.RENEW_TOKEN && this.isIframe()) {\n          // iframe call but same single page\n          this.verbose('Window is in iframe');\n          callback = window.parent.AuthenticationContext.callBackMappedToRenewStates[requestInfo.stateResponse];\n          if (callback) {\n            callback(this._getItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION), requestInfo.parameters[this.CONSTANTS.ACCESS_TOKEN] || requestInfo.parameters[this.CONSTANTS.ID_TOKEN]);\n          }\n          return;\n        } else if (requestInfo.requestType === this.REQUEST_TYPE.LOGIN) {\n          callback = this.callback;\n          if (callback) {\n            callback(this._getItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION), requestInfo.parameters[this.CONSTANTS.ID_TOKEN]);\n          }\n        }\n        // No need to redirect user in case of popup\n        if (!this.popUp) {\n          this.navigate(this._getItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST));\n        }\n      }\n    }\n  }, {\n    key: '_getNavigateUrl',\n    value: function _getNavigateUrl(responseType, resource) {\n      var urlNavigate = this.config.url + 'authorize' + this._serialize(responseType, this.config, resource) + this._addLibMetadata();\n      if (this.config.scope) {\n        urlNavigate += '&scope=' + encodeURIComponent(this.config.scope);\n      }\n      this.info('Navigate url:' + urlNavigate);\n      return urlNavigate;\n    }\n  }, {\n    key: '_extractIdToken',\n    value: function _extractIdToken(encodedIdToken) {\n      // id token will be decoded to get the username\n      var decodedToken = this._decodeJwt(encodedIdToken);\n      if (!decodedToken) {\n        return null;\n      }\n\n      try {\n        var base64IdToken = decodedToken.JWSPayload;\n        var base64Decoded = this._base64DecodeStringUrlSafe(base64IdToken);\n        if (!base64Decoded) {\n          this.info('The returned id_token could not be base64 url safe decoded.');\n          return null;\n        }\n\n        return JSON.parse(base64Decoded);\n      } catch (err) {\n        this.error('The returned id_token could not be decoded', err);\n      }\n\n      return null;\n    }\n  }, {\n    key: '_base64DecodeStringUrlSafe',\n    value: function _base64DecodeStringUrlSafe(base64IdToken) {\n      base64IdToken = base64IdToken.replace(/-/g, '+').replace(/_/g, '/');\n      return decodeURIComponent(escape(window.atob(base64IdToken)));\n    }\n\n    // Auth.node js crack function\n\n  }, {\n    key: '_decodeJwt',\n    value: function _decodeJwt(jwtToken) {\n      if (this._isEmpty(jwtToken)) {\n        return null;\n      }\n\n      var idTokenPartsRegex = /^([^\\.\\s]*)\\.([^\\.\\s]+)\\.([^\\.\\s]*)$/;\n\n      var matches = idTokenPartsRegex.exec(jwtToken);\n      if (!matches || matches.length < 4) {\n        this.warn('The returned id_token is not parseable.');\n        return null;\n      }\n\n      var crackedToken = {\n        header: matches[1],\n        JWSPayload: matches[2],\n        JWSSig: matches[3]\n      };\n\n      return crackedToken;\n    }\n  }, {\n    key: '_convertUrlSafeToRegularBase64EncodedString',\n    value: function _convertUrlSafeToRegularBase64EncodedString(str) {\n      return str.replace('-', '+').replace('_', '/');\n    }\n  }, {\n    key: '_serialize',\n    value: function _serialize(responseType, obj, resource) {\n      var str = [];\n      if (obj !== null) {\n        str.push('?response_type=' + encodeURIComponent(responseType));\n        str.push('client_id=' + encodeURIComponent(obj.clientId));\n        if (resource) {\n          str.push('resource=' + encodeURIComponent(resource));\n        }\n\n        str.push('redirect_uri=' + encodeURIComponent(obj.redirectUri));\n        str.push('state=' + encodeURIComponent(obj.state));\n\n        if (obj.hasOwnProperty('slice')) {\n          str.push('slice=' + encodeURIComponent(obj.slice));\n        }\n\n        if (obj.hasOwnProperty('extraQueryParameter')) {\n          str.push(obj.extraQueryParameter);\n        }\n\n        var correlationId = obj.correlationId ? obj.correlationId : _uuid2.default.v4();\n        str.push('client-request-id=' + encodeURIComponent(correlationId));\n      }\n\n      return str.join('&');\n    }\n  }, {\n    key: '_deserialize',\n    value: function _deserialize(query) {\n      var pl = /\\+/g; // Regex for replacing addition symbol with a space\n      var search = /([^&=]+)=([^&]*)/g;\n      var decode = function decode(s) {\n        return decodeURIComponent(s.replace(pl, ' '));\n      };\n      var obj = {};\n      var match = search.exec(query);\n      while (match) {\n        obj[decode(match[1])] = decode(match[2]);\n        match = search.exec(query);\n      }\n\n      return obj;\n    }\n  }, {\n    key: '_decimalToHex',\n    value: function _decimalToHex(number) {\n      var hex = number.toString(16);\n      while (hex.length < 2) {\n        hex = '0' + hex;\n      }\n      return hex;\n    }\n  }, {\n    key: '_expiresIn',\n    value: function _expiresIn(expires) {\n      return this._now() + parseInt(expires, 10);\n    }\n  }, {\n    key: '_now',\n    value: function _now() {\n      return Math.round(new Date().getTime() / 1000.0);\n    }\n  }, {\n    key: '_addAuthFrame',\n    value: function _addAuthFrame(iframeId) {\n      if (typeof iframeId === 'undefined') {\n        return;\n      }\n\n      this.info('Add auth frame to document:' + iframeId);\n      var authFrame = document.getElementById(iframeId);\n\n      if (!authFrame) {\n        if (document.createElement && document.documentElement && (window.opera || window.navigator.userAgent.indexOf('MSIE 5.0') === -1)) {\n          var ifr = document.createElement('iframe');\n          ifr.setAttribute('id', iframeId);\n          ifr.style.visibility = 'hidden';\n          ifr.style.position = 'absolute';\n          ifr.style.width = ifr.style.height = ifr.borderWidth = '0px';\n\n          authFrame = document.getElementsByTagName('body')[0].appendChild(ifr);\n        } else if (document.body && document.body.insertAdjacentHTML) {\n          document.body.insertAdjacentHTML('beforeEnd', '<iframe name=\"' + iframeId + '\" id=\"' + iframeId + '\" style=\"display:none\"></iframe>');\n        }\n        if (window.frames && window.frames[iframeId]) {\n          authFrame = window.frames[iframeId];\n        }\n      }\n\n      return authFrame;\n    }\n  }, {\n    key: '_saveItem',\n    value: function _saveItem(key, obj) {\n      if (this.config && this.config.cacheLocation && this.config.cacheLocation === 'localStorage') {\n        if (!this._supportsLocalStorage()) {\n          this.info('Local storage is not supported');\n          return false;\n        }\n\n        localStorage.setItem(key, obj);\n\n        return true;\n      }\n\n      // Default as session storage\n      if (!this._supportsSessionStorage()) {\n        this.info('Session storage is not supported');\n        return false;\n      }\n\n      sessionStorage.setItem(key, obj);\n      return true;\n    }\n  }, {\n    key: '_getItem',\n    value: function _getItem(key) {\n      if (this.config && this.config.cacheLocation && this.config.cacheLocation === 'localStorage') {\n        if (!this._supportsLocalStorage()) {\n          this.info('Local storage is not supported');\n          return null;\n        }\n\n        return localStorage.getItem(key);\n      }\n\n      // Default as session storage\n      if (!this._supportsSessionStorage()) {\n        this.info('Session storage is not supported');\n        return null;\n      }\n\n      return sessionStorage.getItem(key);\n    }\n  }, {\n    key: '_supportsLocalStorage',\n    value: function _supportsLocalStorage() {\n      try {\n        return 'localStorage' in window && window.localStorage;\n      } catch (e) {\n        return false;\n      }\n    }\n  }, {\n    key: '_supportsSessionStorage',\n    value: function _supportsSessionStorage() {\n      try {\n        return 'sessionStorage' in window && window.sessionStorage;\n      } catch (e) {\n        return false;\n      }\n    }\n  }, {\n    key: '_cloneConfig',\n    value: function _cloneConfig(obj) {\n      if (obj === null || (typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== 'object') {\n        return obj;\n      }\n\n      var copy = {};\n      for (var attr in obj) {\n        if (obj.hasOwnProperty(attr)) {\n          copy[attr] = obj[attr];\n        }\n      }\n      return copy;\n    }\n  }, {\n    key: '_addLibMetadata',\n    value: function _addLibMetadata() {\n      // x-client-SKU\n      // x-client-Ver\n      return '&x-client-SKU=Js&x-client-Ver=' + this._libVersion();\n    }\n  }, {\n    key: 'log',\n    value: function log(level, message, error) {\n      if (level <= Logging.level) {\n        var timestamp = new Date().toUTCString();\n        var formattedMessage = '';\n\n        if (this.config.correlationId) {\n          formattedMessage = timestamp + ':' + this.config.correlationId + '-' + this._libVersion() + '-' + this.CONSTANTS.LEVEL_STRING_MAP[level] + ' ' + message;\n        } else {\n          formattedMessage = timestamp + ':' + this._libVersion() + '-' + this.CONSTANTS.LEVEL_STRING_MAP[level] + ' ' + message;\n        }\n\n        if (error) {\n          formattedMessage += '\\nstack:\\n' + error.stack;\n        }\n\n        Logging.log(formattedMessage);\n      }\n    }\n  }, {\n    key: 'error',\n    value: function error(message, _error) {\n      this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR, message, _error);\n    }\n  }, {\n    key: 'warn',\n    value: function warn(message) {\n      this.log(this.CONSTANTS.LOGGING_LEVEL.WARN, message, null);\n    }\n  }, {\n    key: 'info',\n    value: function info(message) {\n      this.log(this.CONSTANTS.LOGGING_LEVEL.INFO, message, null);\n    }\n  }, {\n    key: 'verbose',\n    value: function verbose(message) {\n      this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE, message, null);\n    }\n  }, {\n    key: 'navigate',\n    value: function navigate(url) {\n      window.location.replace(url);\n    }\n  }, {\n    key: 'isIframe',\n    value: function isIframe() {\n      return window.parent && window.parent !== window;\n    }\n  }, {\n    key: 'open',\n    value: function open(url, name, features) {\n      return window.open(url, name, features);\n    }\n  }, {\n    key: '_libVersion',\n    value: function _libVersion() {\n      return '1.0.12';\n    }\n  }]);\n\n  return AuthenticationContext;\n}();\n\nexports.default = AuthenticationContext;\n\n\nglobal.Logging = {\n  level: 0,\n  log: function log(message) {}\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(/*! ./../~/webpack/buildin/global.js */ 0)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9zcmMvc2FsdGUtYXV0aC5qcz82MzI2Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQHB1YmxpY1xuICogQGNsYXNzIENvbmZpZ1xuICogQHByb3BlcnR5IHtzdHJpbmd9IHVybCAgICAgICAgICAgICAgICAgUmVxdWlyZWQuICBUaGlzIGlzIHRoZSBiYXNlIHVybCBmb3IgdGhlIGlkZW50aXR5IHByb3ZpZGVyJ3MgYXV0aG9yaXplIGFuZCB0b2tlbiBlbmRwb2ludDsgbm90IGluY2x1ZGluZyB0aGUgd29yZCBhdXRob3JpemUgb3IgdG9rZW4uXG4gKiBAcHJvcGVydHkge3N0cmluZ30gZXh0cmFRdWVyeVBhcmFtZXRlciBPcHRpb25hbC4gIFZhbHVlIHRvIGJlIGluY2x1ZGVkIGFzIGFuIGFkZGl0aW9uYWwgcXVlcnkgcGFyYW1ldGVyIHdoZW4gY2FsbGluZyB0aGUgaWRlbnRpdHkgcHJvdmlkZXIncyBhdXRob3JpemUgYW5kIHRva2VuIGVuZHBvaW50cy4gIFNob3VsZCBiZSBmb3JtYXR0ZWQgYXMgXCJuYW1lPXZhbHVlXCIuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gcmVzcG9uc2VUeXBlICAgICAgICBPcHRpb25hbDsgZGVmYXVsdHMgdG8gaWRfdG9rZW4uICBPQXV0aCAyLjAgUmVzcG9uc2UgVHlwZSB2YWx1ZSB0aGF0IGRldGVybWluZXMgdGhlIGF1dGhvcml6YXRpb24gcHJvY2Vzc2luZyBmbG93IHRvIGJlIHVzZWQsIGluY2x1ZGluZyB3aGF0IHBhcmFtZXRlcnMgYXJlIHJldHVybmVkIGZyb20gdGhlIGVuZHBvaW50cyB1c2VkLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IGNsaWVudElkICAgICAgICAgICAgUmVxdWlyZWQuICBPQXV0aCAyLjAgQ2xpZW50IElkZW50aWZpZXIgdmFsaWQgYXQgdGhlIEF1dGhvcml6YXRpb24gU2VydmVyLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHNjb3BlICAgICAgICAgICAgICAgT3B0aW9uYWwuICBUaGlzIG1heSBiZSB1c2VkIHRvIGRlZmluZSB0aGUgc3BlY2lmaWMgYXV0aG9yaXphdGlvbihzKSBiZWluZyByZXF1ZXN0ZWQgZnJvbSB0aGUgcmVzb3VyY2Ugb3duZXIuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gcmVkaXJlY3RVcmkgICAgICAgICBPcHRpb25hbDsgZGVmYXVsdHMgdG8gY3VycmVudCB3aW5kb3cgbG9jYXRpb24uICBSZWRpcmVjdGlvbiBVUkkgdG8gd2hpY2ggdGhlIHJlc3BvbnNlIHdpbGwgYmUgc2VudC4gVGhpcyBVUkkgTVVTVCBleGFjdGx5IG1hdGNoIG9uZSBvZiB0aGUgUmVkaXJlY3Rpb24gVVJJIHZhbHVlcyBmb3IgdGhlIENsaWVudCBwcmUtcmVnaXN0ZXJlZCBhdCB0aGUgT3BlbklEIFByb3ZpZGVyLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IGxvZ2luUmVzb3VyY2UgICAgICAgT3B0aW9uYWw7IGRlZmF1bHRzIHRvIGNsaWVudElkLlxuICogQHByb3BlcnR5IHtvYmplY3R9IHNlY3VyZWRFbmRwb2ludHMgICAgT3B0aW9uYWwuICBPYmplY3QgY29udGFpbmluZyBvbmUgb3IgbW9yZSBuYW1lZCBlbmRwb2ludHMgKGUuZy4geyBcIkVuZHBvaW50XCI6IFwiUmVzb3VyY2VJZFwiIH0pLiAgVGhpcyBsaXN0IGlzIHVzZWQgdG8gaWRlbnRpZnkgZW5kcG9pbnRzIHRvIHdoaWNoIHRva2VucyBzaG91bGQgYmUgYXR0YWNoZWQuICBJZiBcIkVuZHBvaW50XCIgZXhpc3RzIGFueXdoZXJlIHdpdGhpbiB0aGUgZW5kcG9pbnQgYmVpbmcgY2FsbGVkIHRoZW4gaXQgaXMgY29uc2lkZXJlZCB0byBiZSBhIG1hdGNoLiAgSWYgdGhlIGVuZHBvaW50IGJlaW5nIGNhbGxlZCBkb2Vzbid0IG1hdGNoIHRoZW4gZWl0aGVyIG5vIHRva2VuIHdpbGwgYmUgcGFzc2VkIG9yLCBpZiB0aGUgZW5kcG9pbnQncyBob3N0bmFtZSBtYXRjaGVzIHRoZSBhcHBsaWNhdGlvbiBob3N0bmFtZSwgdGhlbiB0aGUgaWRfdG9rZW4gd2lsbCBiZSBwYXNzZWQuXG4gKiBAcHJvcGVydHkge0FycmF5fSBhbm9ueW1vdXNFbmRwb2ludHMgICBPcHRpb25hbC4gIEFycmF5IGNvbnRhaW5pbmcgb25lIG9yIG1vcmUgZW5kcG9pbnRzIHRvIHdoaWNoIGEgdG9rZW4gbmVlZCBub3QgYmUgYXR0YWNoZWQuICBJZiB0aGUgZW5kcG9pbnQgc3BlY2lmaWVkIGV4aXN0cyBhbnl3aGVyZSB3aXRoaW4gdGhlIGVuZHBvaW50IGJlaW5nIGNhbGxlZCB0aGVuIGl0IGlzIGNvbnNpZGVyZWQgdG8gYmUgYSBtYXRjaC5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gaXNBbmd1bGFyICAgICAgICAgIE9wdGlvbmFsLiAgVXNlZCB0byB0ZWxsIHRoaXMgbGlicmFyeSB3aGV0aGVyIGl0IHNob3VsZCBoYW5kbGUgdGhlIGNhbGxiYWNrIGZyb20gdGhlIGF1dGhvcml6YXRpb24gc2VydmVyIGl0c2VsZiBvciBidWJibGUgdGhlIHJlc3BvbnNlIHVwIHRvIHRoZSBtYWluIHdpbmRvdydzIFVSTCBhbmQgbGV0IHRoZSBBbmd1bGFyIGh0dHAgaW50ZXJjZXB0b3IgaGFuZGxlIGl0LlxuICogQHByb3BlcnR5IHtmdW5jdGlvbn0gZGlzcGxheUNhbGwgICAgICAgT3B0aW9uYWwuICBJZiBzcGVjaWZpZWQgdGhlbiB0aGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdpdGggdGhlIGZ1bGx5LWZvcm1lZCBhdXRob3JpemF0aW9uIHVybCB3aGVuIGxvZ2luIGlzIGludm9rZWQuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IHBvcFVwICAgICAgICAgICAgICBPcHRpb25hbDsgZGVmYXVsdHMgdG8gdHJ1ZS5cbiAqIEBwcm9wZXJ0eSB7ZnVuY3Rpb259IGNhbGxiYWNrICAgICAgICAgIE9wdGlvbmFsLiAgSWYgc3BlY2lmaWVkIHRoZW4gdGhpcyBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCB1cG9uIHJlY2VpdmluZyBhIHN1Y2Nlc3NmdWwgcmVzcG9uc2Ugb3IgZXJyb3IgZnJvbSB0aGUgYXV0aG9yaXphdGlvbiBzZXJ2ZXIuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gaGFzaFByZWZpeCAgICAgICAgICBPcHRpb25hbDsgZGVmYXVsdHMgdG8gZW1wdHkgc3RyaW5nLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHRva2VuQ2FsbGJhY2tUaW1lb3V0IE9wdGlvbmFsOyBkZWZhdWx0cyB0byA2IHNlY29uZHMuICBUaGlzIGlzIHRoZSBhbW91bnQgb2YgdGltZSBzYWx0ZS1hdXRoIHdpbGwgd2FpdCBmb3IgdGhlIGlkZW50aXR5IHByb3ZpZGVyJ3MgdG9rZW4gZW5kcG9pbnQgdG8gcmVzcG9uZC5cbiAqL1xuXG4vKipcbiAqIFVzZXIgaW5mb3JtYXRpb24gZnJvbSBpZHRva2VuLlxuICogIEBjbGFzcyBVc2VyXG4gKiAgQHByb3BlcnR5IHtzdHJpbmd9IHVzZXJOYW1lIC0gdXNlcm5hbWUgYXNzaWduZWQgZnJvbSB1cG4sIGVtYWlsLCBvciBzdWIgKGkuZS4gc3ViamVjdCkuXG4gKiAgQHByb3BlcnR5IHtvYmplY3R9IHByb2ZpbGUgLSBwcm9wZXJ0aWVzIHBhcnNlZCBmcm9tIGlkdG9rZW4uXG4gKi9cblxuaW1wb3J0IHV1aWQgZnJvbSAndXVpZCc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEF1dGhlbnRpY2F0aW9uQ29udGV4dCB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IEF1dGhlbnRpY2F0aW9uQ29udGV4dCBvYmplY3QuXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKiBAcGFyYW0ge29iamVjdH0gIGNvbmZpZyAgICAgICAgICAgICAgIENvbmZpZ3VyYXRpb24gb3B0aW9ucyBmb3IgQXV0aGVudGljYXRpb25Db250ZXh0XG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25maWcpIHtcbiAgICAvKipcbiAgICAqIEVudW0gZm9yIHJlcXVlc3QgdHlwZVxuICAgICogQGVudW0ge3N0cmluZ31cbiAgICAqL1xuICAgIHRoaXMuUkVRVUVTVF9UWVBFID0ge1xuICAgICAgTE9HSU46ICdMT0dJTicsXG4gICAgICBSRU5FV19UT0tFTjogJ1JFTkVXX1RPS0VOJyxcbiAgICAgIFVOS05PV046ICdVTktOT1dOJ1xuICAgIH07XG5cbiAgICAvKipcbiAgICAqIEVudW0gZm9yIHN0b3JhZ2UgY29uc3RhbnRzXG4gICAgKiBAZW51bSB7c3RyaW5nfVxuICAgICovXG4gICAgdGhpcy5DT05TVEFOVFMgPSB7XG4gICAgICBBQ0NFU1NfVE9LRU46ICdhY2Nlc3NfdG9rZW4nLFxuICAgICAgRVhQSVJFU19JTjogJ2V4cGlyZXNfaW4nLFxuICAgICAgSURfVE9LRU46ICdpZF90b2tlbicsXG4gICAgICBFUlJPUl9ERVNDUklQVElPTjogJ2Vycm9yX2Rlc2NyaXB0aW9uJyxcbiAgICAgIFNFU1NJT05fU1RBVEU6ICdzZXNzaW9uX3N0YXRlJyxcbiAgICAgIFNUT1JBR0U6IHtcbiAgICAgICAgVE9LRU5fS0VZUzogJ2F1dGgudG9rZW4ua2V5cycsXG4gICAgICAgIEFDQ0VTU19UT0tFTl9LRVk6ICdhdXRoLmFjY2Vzcy50b2tlbi5rZXknLFxuICAgICAgICBFWFBJUkFUSU9OX0tFWTogJ2F1dGguZXhwaXJhdGlvbi5rZXknLFxuICAgICAgICBTVEFURV9MT0dJTjogJ2F1dGguc3RhdGUubG9naW4nLFxuICAgICAgICBTVEFURV9SRU5FVzogJ2F1dGguc3RhdGUucmVuZXcnLFxuICAgICAgICBOT05DRV9JRFRPS0VOOiAnYXV0aC5ub25jZS5pZHRva2VuJyxcbiAgICAgICAgU0VTU0lPTl9TVEFURTogJ2F1dGguc2Vzc2lvbi5zdGF0ZScsXG4gICAgICAgIFVTRVJOQU1FOiAnYXV0aC51c2VybmFtZScsXG4gICAgICAgIElEVE9LRU46ICdhdXRoLmlkdG9rZW4nLFxuICAgICAgICBFUlJPUjogJ2F1dGguZXJyb3InLFxuICAgICAgICBFUlJPUl9ERVNDUklQVElPTjogJ2F1dGguZXJyb3IuZGVzY3JpcHRpb24nLFxuICAgICAgICBMT0dJTl9SRVFVRVNUOiAnYXV0aC5sb2dpbi5yZXF1ZXN0JyxcbiAgICAgICAgTE9HSU5fRVJST1I6ICdhdXRoLmxvZ2luLmVycm9yJyxcbiAgICAgICAgUkVORVdfU1RBVFVTOiAnYXV0aC50b2tlbi5yZW5ldy5zdGF0dXMnXG4gICAgICB9LFxuICAgICAgUkVTT1VSQ0VfREVMSU1FVEVSOiAnfCcsXG4gICAgICBMT0FERlJBTUVfVElNRU9VVDogJzYwMDAnLFxuICAgICAgVE9LRU5fUkVORVdfU1RBVFVTX0NBTkNFTEVEOiAnQ2FuY2VsZWQnLFxuICAgICAgVE9LRU5fUkVORVdfU1RBVFVTX0NPTVBMRVRFRDogJ0NvbXBsZXRlZCcsXG4gICAgICBUT0tFTl9SRU5FV19TVEFUVVNfSU5fUFJPR1JFU1M6ICdJbiBQcm9ncmVzcycsXG4gICAgICBMT0dHSU5HX0xFVkVMOiB7XG4gICAgICAgIEVSUk9SOiAwLFxuICAgICAgICBXQVJOOiAxLFxuICAgICAgICBJTkZPOiAyLFxuICAgICAgICBWRVJCT1NFOiAzXG4gICAgICB9LFxuICAgICAgTEVWRUxfU1RSSU5HX01BUDoge1xuICAgICAgICAwOiAnRVJST1I6JyxcbiAgICAgICAgMTogJ1dBUk5JTkc6JyxcbiAgICAgICAgMjogJ0lORk86JyxcbiAgICAgICAgMzogJ1ZFUkJPU0U6J1xuICAgICAgfSxcbiAgICAgIFBPUFVQX1dJRFRIOiA0ODMsXG4gICAgICBQT1BVUF9IRUlHSFQ6IDYwMFxuICAgIH07XG5cbiAgICBpZiAod2luZG93LkF1dGhlbnRpY2F0aW9uQ29udGV4dCkge1xuICAgICAgcmV0dXJuIHdpbmRvdy5BdXRoZW50aWNhdGlvbkNvbnRleHQ7XG4gICAgfVxuICAgIHdpbmRvdy5BdXRoZW50aWNhdGlvbkNvbnRleHQgPSB0aGlzO1xuXG4gICAgLy8gcHVibGljXG4gICAgdGhpcy5jb25maWcgPSB7fTtcbiAgICB0aGlzLmNhbGxiYWNrID0gbnVsbDtcbiAgICB0aGlzLnBvcFVwID0gZmFsc2U7XG4gICAgdGhpcy5pc0FuZ3VsYXIgPSBmYWxzZTtcblxuICAgIC8vIHByaXZhdGVcbiAgICB0aGlzLl91c2VyID0gbnVsbDtcbiAgICB0aGlzLl9hY3RpdmVSZW5ld2FscyA9IHt9O1xuICAgIHRoaXMuX2xvZ2luSW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgIHRoaXMuX3JlbmV3U3RhdGVzID0gW107XG5cbiAgICB0aGlzLmNhbGxCYWNrTWFwcGVkVG9SZW5ld1N0YXRlcyA9IHt9O1xuICAgIHRoaXMuY2FsbEJhY2tzTWFwcGVkVG9SZW5ld1N0YXRlcyA9IHt9O1xuXG4gICAgLy8gdmFsaWRhdGUgYmVmb3JlIGNvbnN0cnVjdG9yIGFzc2lnbm1lbnRzXG4gICAgaWYgKGNvbmZpZy5kaXNwbGF5Q2FsbCAmJiB0eXBlb2YgY29uZmlnLmRpc3BsYXlDYWxsICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Rpc3BsYXlDYWxsIGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG4gICAgfVxuXG4gICAgaWYgKCFjb25maWcuY2xpZW50SWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignY2xpZW50SWQgaXMgcmVxdWlyZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoIWNvbmZpZy51cmwgfHwgIWNvbmZpZy51cmwubWF0Y2goL15odHRwczpcXC9cXC8uKlxcLyQvKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCd1cmwgbXVzdCBiZSBhIHZhbGlkIGh0dHBzIGVuZHBvaW50IHRoYXQgZW5kcyBpbiBhIGZvcndhcmQgc2xhc2guJyk7XG4gICAgfVxuXG4gICAgdGhpcy5jb25maWcgPSB0aGlzLl9jbG9uZUNvbmZpZyhjb25maWcpO1xuXG4gICAgaWYgKHRoaXMuY29uZmlnLnBvcFVwKSB7XG4gICAgICB0aGlzLnBvcFVwID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jb25maWcuY2FsbGJhY2sgJiYgdHlwZW9mIHRoaXMuY29uZmlnLmNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aGlzLmNhbGxiYWNrID0gdGhpcy5jb25maWcuY2FsbGJhY2s7XG4gICAgfVxuXG4gICAgLy8gQXBwIGNhbiByZXF1ZXN0IGlkdG9rZW4gZm9yIGl0c2VsZiB1c2luZyBjbGllbnRpZCBhcyByZXNvdXJjZVxuICAgIGlmICghdGhpcy5jb25maWcubG9naW5SZXNvdXJjZSkge1xuICAgICAgdGhpcy5jb25maWcubG9naW5SZXNvdXJjZSA9IHRoaXMuY29uZmlnLmNsaWVudElkO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5jb25maWcucmVkaXJlY3RVcmkpIHtcbiAgICAgIHRoaXMuY29uZmlnLnJlZGlyZWN0VXJpID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmNvbmZpZy5hbm9ueW1vdXNFbmRwb2ludHMpIHtcbiAgICAgIHRoaXMuY29uZmlnLmFub255bW91c0VuZHBvaW50cyA9IFtdO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbmZpZy5pc0FuZ3VsYXIpIHtcbiAgICAgIHRoaXMuaXNBbmd1bGFyID0gdGhpcy5jb25maWcuaXNBbmd1bGFyO1xuICAgIH1cblxuICAgIHRoaXMuc2V0UmVzcG9uc2VUeXBlKHRoaXMuY29uZmlnLnJlc3BvbnNlVHlwZSk7XG5cbiAgICBpZiAodGhpcy5faXNFbXB0eSh0aGlzLmNvbmZpZy5oYXNoUHJlZml4KSkge1xuICAgICAgdGhpcy5jb25maWcuaGFzaFByZWZpeCA9ICcnO1xuICAgIH1cblxuICAgIGlmICh0aGlzLl9pc0VtcHR5KHRoaXMuY29uZmlnLnRva2VuQ2FsbGJhY2tUaW1lb3V0KSkge1xuICAgICAgdGhpcy5jb25maWcudG9rZW5DYWxsYmFja1RpbWVvdXQgPSB0aGlzLkNPTlNUQU5UUy5MT0FERlJBTUVfVElNRU9VVDtcbiAgICB9XG4gIH1cblxuICBzZXRSZXNwb25zZVR5cGUocmVzcG9uc2VUeXBlKSB7XG4gICAgdGhpcy5jb25maWcucmVzcG9uc2VUeXBlID0gcmVzcG9uc2VUeXBlIHx8IHRoaXMuQ09OU1RBTlRTLklEX1RPS0VOO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgaW5pdGlhbCBJZHRva2VuIGZvciB0aGUgYXBwIGJhY2tlbmRcbiAgICogU2F2ZXMgdGhlIHJlc3VsdGluZyBJZHRva2VuIGluIGxvY2FsU3RvcmFnZS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHN0YXJ0UGFnZSB0aGUgc3RhcnQgcGFnZVxuICAgKi9cbiAgbG9naW4oc3RhcnRQYWdlKSB7XG4gICAgLy8gVG9rZW4gaXMgbm90IHByZXNlbnQgYW5kIHVzZXIgbmVlZHMgdG8gbG9naW5cbiAgICBpZiAodGhpcy5fbG9naW5JblByb2dyZXNzKSB7XG4gICAgICB0aGlzLmluZm8oJ0xvZ2luIGluIHByb2dyZXNzJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGV4cGVjdGVkU3RhdGUgPSB1dWlkLnY0KCk7XG4gICAgdGhpcy5jb25maWcuc3RhdGUgPSBleHBlY3RlZFN0YXRlO1xuICAgIHRoaXMuX2lkVG9rZW5Ob25jZSA9IHV1aWQudjQoKTtcbiAgICBpZiAoIXN0YXJ0UGFnZSkge1xuICAgICAgc3RhcnRQYWdlID0gd2luZG93LmxvY2F0aW9uO1xuICAgIH1cbiAgICB0aGlzLnZlcmJvc2UoJ0V4cGVjdGVkIHN0YXRlOiAnICsgZXhwZWN0ZWRTdGF0ZSArICcgc3RhcnRQYWdlOicgKyBzdGFydFBhZ2UpO1xuICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuTE9HSU5fUkVRVUVTVCwgc3RhcnRQYWdlKTtcbiAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkxPR0lOX0VSUk9SLCAnJyk7XG4gICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5TVEFURV9MT0dJTiwgZXhwZWN0ZWRTdGF0ZSk7XG4gICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5OT05DRV9JRFRPS0VOLCB0aGlzLl9pZFRva2VuTm9uY2UpO1xuICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1IsICcnKTtcbiAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVSUk9SX0RFU0NSSVBUSU9OLCAnJyk7XG4gICAgY29uc3QgdXJsTmF2aWdhdGUgPSB0aGlzLl9nZXROYXZpZ2F0ZVVybCh0aGlzLmNvbmZpZy5yZXNwb25zZVR5cGUsIG51bGwpICsgJyZub25jZT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuX2lkVG9rZW5Ob25jZSk7XG4gICAgdGhpcy5fbG9naW5JblByb2dyZXNzID0gdHJ1ZTtcbiAgICBpZiAodGhpcy5wb3BVcCkge1xuICAgICAgdGhpcy5fbG9naW5Qb3B1cCh1cmxOYXZpZ2F0ZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLmNvbmZpZy5kaXNwbGF5Q2FsbCkge1xuICAgICAgLy8gVXNlciBkZWZpbmVkIHdheSBvZiBoYW5kbGluZyB0aGUgbmF2aWdhdGlvblxuICAgICAgdGhpcy5jb25maWcuZGlzcGxheUNhbGwodXJsTmF2aWdhdGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb21wdFVzZXIodXJsTmF2aWdhdGUpO1xuICAgIH1cbiAgfVxuXG4gIF9vcGVuUG9wdXAodXJsTmF2aWdhdGUsIHRpdGxlLCBwb3BVcFdpZHRoLCBwb3BVcEhlaWdodCkge1xuICAgIHRyeSB7XG4gICAgICAvKipcbiAgICAgICogYWRkaW5nIHdpbkxlZnQgYW5kIHdpblRvcCB0byBhY2NvdW50IGZvciBkdWFsIG1vbml0b3JcbiAgICAgICogdXNpbmcgc2NyZWVuTGVmdCBhbmQgc2NyZWVuVG9wIGZvciBJRTggYW5kIGVhcmxpZXJcbiAgICAgICovXG4gICAgICBjb25zdCB3aW5MZWZ0ID0gd2luZG93LnNjcmVlbkxlZnQgPyB3aW5kb3cuc2NyZWVuTGVmdCA6IHdpbmRvdy5zY3JlZW5YO1xuICAgICAgY29uc3Qgd2luVG9wID0gd2luZG93LnNjcmVlblRvcCA/IHdpbmRvdy5zY3JlZW5Ub3AgOiB3aW5kb3cuc2NyZWVuWTtcbiAgICAgIC8qKlxuICAgICAgKiB3aW5kb3cuaW5uZXJXaWR0aCBkaXNwbGF5cyBicm93c2VyIHdpbmRvdydzIGhlaWdodCBhbmQgd2lkdGggZXhjbHVkaW5nIHRvb2xiYXJzXG4gICAgICAqIHVzaW5nIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCBmb3IgSUU4IGFuZCBlYXJsaWVyXG4gICAgICAqL1xuICAgICAgY29uc3Qgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHwgZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDtcbiAgICAgIGNvbnN0IGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IHx8IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0O1xuICAgICAgY29uc3QgbGVmdCA9ICgod2lkdGggLyAyKSAtIChwb3BVcFdpZHRoIC8gMikpICsgd2luTGVmdDtcbiAgICAgIGNvbnN0IHRvcCA9ICgoaGVpZ2h0IC8gMikgLSAocG9wVXBIZWlnaHQgLyAyKSkgKyB3aW5Ub3A7XG5cbiAgICAgIGNvbnN0IHBvcHVwV2luZG93ID0gdGhpcy5vcGVuKHVybE5hdmlnYXRlLCB0aXRsZSwgJ3dpZHRoPScgKyBwb3BVcFdpZHRoICsgJywgaGVpZ2h0PScgKyBwb3BVcEhlaWdodCArICcsIHRvcD0nICsgdG9wICsgJywgbGVmdD0nICsgbGVmdCk7XG4gICAgICBpZiAocG9wdXBXaW5kb3cuZm9jdXMpIHtcbiAgICAgICAgcG9wdXBXaW5kb3cuZm9jdXMoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwb3B1cFdpbmRvdztcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLndhcm4oJ0Vycm9yIG9wZW5pbmcgcG9wdXAsICcgKyBlLm1lc3NhZ2UpO1xuICAgICAgdGhpcy5fbG9naW5JblByb2dyZXNzID0gZmFsc2U7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBfbG9naW5Qb3B1cCh1cmxOYXZpZ2F0ZSkge1xuICAgIGNvbnN0IHBvcHVwV2luZG93ID0gdGhpcy5fb3BlblBvcHVwKHVybE5hdmlnYXRlLCAnbG9naW4nLCB0aGlzLkNPTlNUQU5UUy5QT1BVUF9XSURUSCwgdGhpcy5DT05TVEFOVFMuUE9QVVBfSEVJR0hUKTtcbiAgICBpZiAocG9wdXBXaW5kb3cgPT09IG51bGwpIHtcbiAgICAgIHRoaXMud2FybignUG9wdXAgV2luZG93IGlzIG51bGwuIFRoaXMgY2FuIGhhcHBlbiBpZiB5b3UgYXJlIHVzaW5nIElFJyk7XG4gICAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVSUk9SLCAnRXJyb3Igb3BlbmluZyBwb3B1cCcpO1xuICAgICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUl9ERVNDUklQVElPTiwgJ1BvcHVwIFdpbmRvdyBpcyBudWxsLiBUaGlzIGNhbiBoYXBwZW4gaWYgeW91IGFyZSB1c2luZyBJRScpO1xuICAgICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5MT0dJTl9FUlJPUiwgJ1BvcHVwIFdpbmRvdyBpcyBudWxsLiBUaGlzIGNhbiBoYXBwZW4gaWYgeW91IGFyZSB1c2luZyBJRScpO1xuICAgICAgaWYgKHRoaXMuY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jYWxsYmFjayh0aGlzLl9nZXRJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuTE9HSU5fRVJST1IpLCBudWxsKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHJlZ2lzdGVyZWRSZWRpcmVjdFVyaTtcbiAgICBpZiAodGhpcy5jb25maWcucmVkaXJlY3RVcmkuaW5kZXhPZignIycpID09PSAtMSkge1xuICAgICAgcmVnaXN0ZXJlZFJlZGlyZWN0VXJpID0gdGhpcy5jb25maWcucmVkaXJlY3RVcmk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlZ2lzdGVyZWRSZWRpcmVjdFVyaSA9IHRoaXMuY29uZmlnLnJlZGlyZWN0VXJpLnNwbGl0KCcjJylbMF07XG4gICAgfVxuICAgIGNvbnN0IHBvbGxUaW1lciA9IHdpbmRvdy5zZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICBpZiAoIXBvcHVwV2luZG93IHx8IHBvcHVwV2luZG93LmNsb3NlZCB8fCBwb3B1cFdpbmRvdy5jbG9zZWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9sb2dpbkluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwocG9sbFRpbWVyKTtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGlmIChwb3B1cFdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YocmVnaXN0ZXJlZFJlZGlyZWN0VXJpKSAhPT0gLTEpIHtcbiAgICAgICAgICBpZiAodGhpcy5pc0FuZ3VsYXIpIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gcG9wdXBXaW5kb3cubG9jYXRpb24uaGFzaDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVXaW5kb3dDYWxsYmFjayhwb3B1cFdpbmRvdy5sb2NhdGlvbi5oYXNoLCBwb3B1cFdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbChwb2xsVGltZXIpO1xuICAgICAgICAgIHRoaXMuX2xvZ2luSW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMuaW5mbygnQ2xvc2luZyBwb3B1cCB3aW5kb3cnKTtcbiAgICAgICAgICBwb3B1cFdpbmRvdy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICB9XG4gICAgfSwgMjApO1xuICB9XG5cbiAgbG9naW5JblByb2dyZXNzKCkge1xuICAgIHJldHVybiB0aGlzLl9sb2dpbkluUHJvZ3Jlc3M7XG4gIH1cblxuICBfaGFzUmVzb3VyY2Uoa2V5KSB7XG4gICAgY29uc3Qga2V5cyA9IHRoaXMuX2dldEl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5UT0tFTl9LRVlTKTtcbiAgICByZXR1cm4ga2V5cyAmJiAhdGhpcy5faXNFbXB0eShrZXlzKSAmJiAoa2V5cy5pbmRleE9mKGtleSArIHRoaXMuQ09OU1RBTlRTLlJFU09VUkNFX0RFTElNRVRFUikgPiAtMSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0b2tlbiBmb3IgdGhlIHNwZWNpZmllZCByZXNvdXJjZSBmcm9tIGxvY2FsIHN0b3JhZ2UgY2FjaGVcbiAgICogQHBhcmFtIHtzdHJpbmd9ICAgcmVzb3VyY2UgQSBVUkkgdGhhdCBpZGVudGlmaWVzIHRoZSByZXNvdXJjZSBmb3Igd2hpY2ggdGhlIHRva2VuIGlzIHZhbGlkLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IHRva2VuIGlmIGV4aXN0cyBhbmQgbm90IGV4cGlyZWQgb3IgbnVsbFxuICAgKi9cbiAgZ2V0Q2FjaGVkVG9rZW4ocmVzb3VyY2UpIHtcbiAgICBpZiAoIXRoaXMuX2hhc1Jlc291cmNlKHJlc291cmNlKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgdG9rZW4gPSB0aGlzLl9nZXRJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuQUNDRVNTX1RPS0VOX0tFWSArIHJlc291cmNlKTtcbiAgICBjb25zdCBleHBpcmVkID0gdGhpcy5fZ2V0SXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVYUElSQVRJT05fS0VZICsgcmVzb3VyY2UpO1xuXG4gICAgLy8gSWYgZXhwaXJhdGlvbiBpcyB3aXRoaW4gb2Zmc2V0LCBpdCB3aWxsIGZvcmNlIHJlbmV3XG4gICAgY29uc3Qgb2Zmc2V0ID0gdGhpcy5jb25maWcuZXhwaXJlT2Zmc2V0U2Vjb25kcyB8fCAxMjA7XG5cbiAgICBpZiAoZXhwaXJlZCAmJiAoZXhwaXJlZCA+IHRoaXMuX25vdygpICsgb2Zmc2V0KSkge1xuICAgICAgcmV0dXJuIHRva2VuO1xuICAgIH1cbiAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkFDQ0VTU19UT0tFTl9LRVkgKyByZXNvdXJjZSwgJycpO1xuICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVhQSVJBVElPTl9LRVkgKyByZXNvdXJjZSwgMCk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIGFuZCBwYXJzZSBpZFRva2VuIGZyb20gbG9jYWxzdG9yYWdlXG4gICAqIEByZXR1cm4ge1VzZXJ9IHVzZXIgb2JqZWN0XG4gICAqL1xuICBnZXRDYWNoZWRVc2VyKCkge1xuICAgIGlmICh0aGlzLl91c2VyKSB7XG4gICAgICByZXR1cm4gdGhpcy5fdXNlcjtcbiAgICB9XG5cbiAgICBjb25zdCBpZHRva2VuID0gdGhpcy5fZ2V0SXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLklEVE9LRU4pO1xuICAgIHRoaXMuX3VzZXIgPSB0aGlzLl9jcmVhdGVVc2VyKGlkdG9rZW4pO1xuICAgIHJldHVybiB0aGlzLl91c2VyO1xuICB9XG5cbiAgcmVnaXN0ZXJDYWxsYmFjayhleHBlY3RlZFN0YXRlLCByZXNvdXJjZSwgY2FsbGJhY2spIHtcbiAgICB0aGlzLl9hY3RpdmVSZW5ld2Fsc1tyZXNvdXJjZV0gPSBleHBlY3RlZFN0YXRlO1xuICAgIGlmICghdGhpcy5jYWxsQmFja3NNYXBwZWRUb1JlbmV3U3RhdGVzW2V4cGVjdGVkU3RhdGVdKSB7XG4gICAgICB0aGlzLmNhbGxCYWNrc01hcHBlZFRvUmVuZXdTdGF0ZXNbZXhwZWN0ZWRTdGF0ZV0gPSBbXTtcbiAgICB9XG4gICAgdGhpcy5jYWxsQmFja3NNYXBwZWRUb1JlbmV3U3RhdGVzW2V4cGVjdGVkU3RhdGVdLnB1c2goY2FsbGJhY2spO1xuICAgIGlmICghdGhpcy5jYWxsQmFja01hcHBlZFRvUmVuZXdTdGF0ZXNbZXhwZWN0ZWRTdGF0ZV0pIHtcbiAgICAgIHRoaXMuY2FsbEJhY2tNYXBwZWRUb1JlbmV3U3RhdGVzW2V4cGVjdGVkU3RhdGVdID0gKG1lc3NhZ2UsIHRva2VuKSA9PiB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5jYWxsQmFja3NNYXBwZWRUb1JlbmV3U3RhdGVzW2V4cGVjdGVkU3RhdGVdLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuY2FsbEJhY2tzTWFwcGVkVG9SZW5ld1N0YXRlc1tleHBlY3RlZFN0YXRlXVtpXShtZXNzYWdlLCB0b2tlbik7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMud2FybihlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2FjdGl2ZVJlbmV3YWxzW3Jlc291cmNlXSA9IG51bGw7XG4gICAgICAgIHRoaXMuY2FsbEJhY2tzTWFwcGVkVG9SZW5ld1N0YXRlc1tleHBlY3RlZFN0YXRlXSA9IG51bGw7XG4gICAgICAgIHRoaXMuY2FsbEJhY2tNYXBwZWRUb1JlbmV3U3RhdGVzW2V4cGVjdGVkU3RhdGVdID0gbnVsbDtcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFjcXVpcmVzIGFjY2VzcyB0b2tlbiB3aXRoIGhpZGRlbiBpZnJhbWVcbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlc291cmNlICBSZXNvdXJjZVVyaSBpZGVudGlmeWluZyB0aGUgdGFyZ2V0IHJlc291cmNlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjYWxsYmFjayAgUmVzb3VyY2VVcmkgaWRlbnRpZnlpbmcgdGhlIHRhcmdldCByZXNvdXJjZVxuICAgKi9cbiAgX3JlbmV3VG9rZW4ocmVzb3VyY2UsIGNhbGxiYWNrKSB7XG4gICAgLy8gdXNlIGlmcmFtZSB0byB0cnkgcmVmcmVzaCB0b2tlblxuICAgIC8vIHVzZSBnaXZlbiByZXNvdXJjZSB0byBjcmVhdGUgbmV3IGF1dGh6IHVybFxuICAgIHRoaXMuaW5mbygncmVuZXdUb2tlbiBpcyBjYWxsZWQgZm9yIHJlc291cmNlOicgKyByZXNvdXJjZSk7XG4gICAgY29uc3QgZnJhbWVIYW5kbGUgPSB0aGlzLl9hZGRBdXRoRnJhbWUoJ2F1dGhSZW5ld0ZyYW1lJyArIHJlc291cmNlKTtcbiAgICBjb25zdCBleHBlY3RlZFN0YXRlID0gdXVpZC52NCgpICsgJ3wnICsgcmVzb3VyY2U7XG4gICAgdGhpcy5jb25maWcuc3RhdGUgPSBleHBlY3RlZFN0YXRlO1xuICAgIC8vIHJlbmV3IGhhcHBlbnMgaW4gaWZyYW1lLCBzbyBpdCBrZWVwcyBqYXZhc2NyaXB0IGNvbnRleHRcbiAgICB0aGlzLl9yZW5ld1N0YXRlcy5wdXNoKGV4cGVjdGVkU3RhdGUpO1xuXG4gICAgdGhpcy52ZXJib3NlKCdSZW5ldyB0b2tlbiBFeHBlY3RlZCBzdGF0ZTogJyArIGV4cGVjdGVkU3RhdGUpO1xuICAgIGxldCB1cmxOYXZpZ2F0ZSA9IHRoaXMuX2dldE5hdmlnYXRlVXJsKCd0b2tlbicsIHJlc291cmNlKSArICcmcHJvbXB0PW5vbmUnO1xuICAgIHVybE5hdmlnYXRlID0gdGhpcy5fYWRkSGludFBhcmFtZXRlcnModXJsTmF2aWdhdGUpO1xuXG4gICAgdGhpcy5yZWdpc3RlckNhbGxiYWNrKGV4cGVjdGVkU3RhdGUsIHJlc291cmNlLCBjYWxsYmFjayk7XG4gICAgdGhpcy52ZXJib3NlKCdOYXZpZ2F0ZSB0bzonICsgdXJsTmF2aWdhdGUpO1xuICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuTE9HSU5fUkVRVUVTVCwgJycpO1xuICAgIGZyYW1lSGFuZGxlLnNyYyA9ICdhYm91dDpibGFuayc7XG4gICAgdGhpcy5fbG9hZEZyYW1lVGltZW91dCh1cmxOYXZpZ2F0ZSwgJ2F1dGhSZW5ld0ZyYW1lJyArIHJlc291cmNlLCByZXNvdXJjZSk7XG4gIH1cblxuICBfcmVuZXdJZFRva2VuKGNhbGxiYWNrKSB7XG4gICAgLy8gdXNlIGlmcmFtZSB0byB0cnkgcmVmcmVzaCB0b2tlblxuICAgIHRoaXMuaW5mbygncmVuZXdJZFRva2VuIGlzIGNhbGxlZCcpO1xuICAgIGNvbnN0IGZyYW1lSGFuZGxlID0gdGhpcy5fYWRkQXV0aEZyYW1lKCdhdXRoSWRUb2tlbkZyYW1lJyk7XG4gICAgY29uc3QgZXhwZWN0ZWRTdGF0ZSA9IHV1aWQudjQoKSArICd8JyArIHRoaXMuY29uZmlnLmNsaWVudElkO1xuICAgIHRoaXMuX2lkVG9rZW5Ob25jZSA9IHV1aWQudjQoKTtcbiAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLk5PTkNFX0lEVE9LRU4sIHRoaXMuX2lkVG9rZW5Ob25jZSk7XG4gICAgdGhpcy5jb25maWcuc3RhdGUgPSBleHBlY3RlZFN0YXRlO1xuICAgIC8vIHJlbmV3IGhhcHBlbnMgaW4gaWZyYW1lLCBzbyBpdCBrZWVwcyBqYXZhc2NyaXB0IGNvbnRleHRcbiAgICB0aGlzLl9yZW5ld1N0YXRlcy5wdXNoKGV4cGVjdGVkU3RhdGUpO1xuXG4gICAgdGhpcy52ZXJib3NlKCdSZW5ldyBJZHRva2VuIEV4cGVjdGVkIHN0YXRlOiAnICsgZXhwZWN0ZWRTdGF0ZSk7XG4gICAgbGV0IHVybE5hdmlnYXRlID0gdGhpcy5fZ2V0TmF2aWdhdGVVcmwodGhpcy5jb25maWcucmVzcG9uc2VUeXBlLCBudWxsKSArICcmcHJvbXB0PW5vbmUnO1xuICAgIHVybE5hdmlnYXRlID0gdGhpcy5fYWRkSGludFBhcmFtZXRlcnModXJsTmF2aWdhdGUpO1xuXG4gICAgdXJsTmF2aWdhdGUgKz0gJyZub25jZT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuX2lkVG9rZW5Ob25jZSk7XG4gICAgdGhpcy5yZWdpc3RlckNhbGxiYWNrKGV4cGVjdGVkU3RhdGUsIHRoaXMuY29uZmlnLmNsaWVudElkLCBjYWxsYmFjayk7XG4gICAgdGhpcy5pZFRva2VuTm9uY2UgPSBudWxsO1xuICAgIHRoaXMudmVyYm9zZSgnTmF2aWdhdGUgdG86JyArIHVybE5hdmlnYXRlKTtcbiAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkxPR0lOX1JFUVVFU1QsICcnKTtcbiAgICBmcmFtZUhhbmRsZS5zcmMgPSAnYWJvdXQ6YmxhbmsnO1xuICAgIHRoaXMuX2xvYWRGcmFtZVRpbWVvdXQodXJsTmF2aWdhdGUsICdhdXRoSWRUb2tlbkZyYW1lJywgdGhpcy5jb25maWcuY2xpZW50SWQpO1xuICB9XG5cbiAgX3VybENvbnRhaW5zUXVlcnlTdHJpbmdQYXJhbWV0ZXIobmFtZSwgdXJsKSB7XG4gICAgLy8gcmVnZXggdG8gZGV0ZWN0IHBhdHRlcm4gb2YgYSA/IG9yICYgZm9sbG93ZWQgYnkgdGhlIG5hbWUgcGFyYW1ldGVyIGFuZCBhbiBlcXVhbHMgY2hhcmFjdGVyXG4gICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKCdbXFxcXD8mXScgKyBuYW1lICsgJz0nKTtcbiAgICByZXR1cm4gcmVnZXgudGVzdCh1cmwpO1xuICB9XG5cbiAgLy8gQ2FsbGluZyBfbG9hZEZyYW1lIGJ1dCB3aXRoIGEgdGltZW91dCB0byBzaWduYWwgZmFpbHVyZSBpbiBsb2FkZnJhbWVTdGF0dXMuIENhbGxiYWNrcyBhcmUgbGVmdFxuICAvLyByZWdpc3RlcmVkIHdoZW4gbmV0d29yayBlcnJvcnMgb2NjdXIgYW5kIHN1YnNlcXVlbnQgdG9rZW4gcmVxdWVzdHMgZm9yIHNhbWUgcmVzb3VyY2UgYXJlIHJlZ2lzdGVyZWQgdG8gdGhlIHBlbmRpbmcgcmVxdWVzdFxuICBfbG9hZEZyYW1lVGltZW91dCh1cmxOYXZpZ2F0aW9uLCBmcmFtZU5hbWUsIHJlc291cmNlKSB7XG4gICAgLy8gc2V0IGlmcmFtZSBzZXNzaW9uIHRvIHBlbmRpbmdcbiAgICB0aGlzLnZlcmJvc2UoJ1NldCBsb2FkaW5nIHN0YXRlIHRvIHBlbmRpbmcgZm9yOiAnICsgcmVzb3VyY2UpO1xuICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuUkVORVdfU1RBVFVTICsgcmVzb3VyY2UsIHRoaXMuQ09OU1RBTlRTLlRPS0VOX1JFTkVXX1NUQVRVU19JTl9QUk9HUkVTUyk7XG4gICAgdGhpcy5fbG9hZEZyYW1lKHVybE5hdmlnYXRpb24sIGZyYW1lTmFtZSk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAodGhpcy5fZ2V0SXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlJFTkVXX1NUQVRVUyArIHJlc291cmNlKSA9PT0gdGhpcy5DT05TVEFOVFMuVE9LRU5fUkVORVdfU1RBVFVTX0lOX1BST0dSRVNTKSB7XG4gICAgICAgIC8vIGZhaWwgdGhlIGlmcmFtZSBzZXNzaW9uIGlmIGl0J3MgaW4gcGVuZGluZyBzdGF0ZVxuICAgICAgICB0aGlzLnZlcmJvc2UoJ0xvYWRpbmcgZnJhbWUgaGFzIHRpbWVkIG91dCBhZnRlcjogJyArICh0aGlzLmNvbmZpZy50b2tlbkNhbGxiYWNrVGltZW91dCAvIDEwMDApICsgJyBzZWNvbmRzIGZvciByZXNvdXJjZSAnICsgcmVzb3VyY2UpO1xuICAgICAgICBjb25zdCBleHBlY3RlZFN0YXRlID0gdGhpcy5fYWN0aXZlUmVuZXdhbHNbcmVzb3VyY2VdO1xuXG4gICAgICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuUkVORVdfU1RBVFVTICsgcmVzb3VyY2UsIHRoaXMuQ09OU1RBTlRTLlRPS0VOX1JFTkVXX1NUQVRVU19DQU5DRUxFRCk7XG5cbiAgICAgICAgaWYgKGV4cGVjdGVkU3RhdGUgJiYgdGhpcy5jYWxsQmFja01hcHBlZFRvUmVuZXdTdGF0ZXNbZXhwZWN0ZWRTdGF0ZV0pIHtcbiAgICAgICAgICB0aGlzLmNhbGxCYWNrTWFwcGVkVG9SZW5ld1N0YXRlc1tleHBlY3RlZFN0YXRlXSgnVG9rZW4gcmVuZXdhbCBvcGVyYXRpb24gZmFpbGVkIGR1ZSB0byB0aW1lb3V0JywgbnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCB0aGlzLmNvbmZpZy50b2tlbkNhbGxiYWNrVGltZW91dCk7XG4gIH1cblxuICBfbG9hZEZyYW1lKHVybE5hdmlnYXRlLCBmcmFtZU5hbWUpIHtcbiAgICAvLyBUaGlzIHRyaWNrIG92ZXJjb21lcyBpZnJhbWUgbmF2aWdhdGlvbiBpbiBJRVxuICAgIC8vIElFIGRvZXMgbm90IGxvYWQgdGhlIHBhZ2UgY29uc2lzdGVudGx5IGluIGlmcmFtZVxuICAgIHRoaXMuaW5mbygnTG9hZEZyYW1lOiAnICsgZnJhbWVOYW1lKTtcbiAgICBjb25zdCBmcmFtZUNoZWNrID0gZnJhbWVOYW1lO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3QgZnJhbWVIYW5kbGUgPSB0aGlzLl9hZGRBdXRoRnJhbWUoZnJhbWVDaGVjayk7XG4gICAgICBpZiAoZnJhbWVIYW5kbGUuc3JjID09PSAnJyB8fCBmcmFtZUhhbmRsZS5zcmMgPT09ICdhYm91dDpibGFuaycpIHtcbiAgICAgICAgZnJhbWVIYW5kbGUuc3JjID0gdXJsTmF2aWdhdGU7XG4gICAgICAgIHRoaXMuX2xvYWRGcmFtZSh1cmxOYXZpZ2F0ZSwgZnJhbWVDaGVjayk7XG4gICAgICB9XG4gICAgfSwgNTAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBY3F1aXJlIHRva2VuIGZyb20gY2FjaGUgaWYgbm90IGV4cGlyZWQgYW5kIGF2YWlsYWJsZS4gQWNxdWlyZXMgdG9rZW4gZnJvbSBpZnJhbWUgaWYgZXhwaXJlZC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlc291cmNlICBSZXNvdXJjZVVyaSBpZGVudGlmeWluZyB0aGUgdGFyZ2V0IHJlc291cmNlXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIFRoZSBjYWxsYmFjayBmdW5jdGlvblxuICAgKi9cbiAgYWNxdWlyZVRva2VuKHJlc291cmNlLCBjYWxsYmFjaykge1xuICAgIGlmICh0aGlzLl9pc0VtcHR5KHJlc291cmNlKSkge1xuICAgICAgdGhpcy53YXJuKCdyZXNvdXJjZSBpcyByZXF1aXJlZCcpO1xuICAgICAgY2FsbGJhY2soJ3Jlc291cmNlIGlzIHJlcXVpcmVkJywgbnVsbCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdG9rZW4gPSB0aGlzLmdldENhY2hlZFRva2VuKHJlc291cmNlKTtcbiAgICBpZiAodG9rZW4pIHtcbiAgICAgIHRoaXMuaW5mbygnVG9rZW4gaXMgYWxyZWFkeSBpbiBjYWNoZSBmb3IgcmVzb3VyY2U6JyArIHJlc291cmNlKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHRva2VuKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuX3VzZXIpIHtcbiAgICAgIHRoaXMud2FybignVXNlciBsb2dpbiBpcyByZXF1aXJlZCcpO1xuICAgICAgY2FsbGJhY2soJ1VzZXIgbG9naW4gaXMgcmVxdWlyZWQnLCBudWxsKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyByZWZyZXNoIGF0dGVwdCB3aXRoIGlmcmFtZVxuICAgIC8vIEFscmVhZHkgcmVuZXdpbmcgZm9yIHRoaXMgcmVzb3VyY2UsIGNhbGxiYWNrIHdoZW4gd2UgZ2V0IHRoZSB0b2tlbi5cbiAgICBpZiAodGhpcy5fYWN0aXZlUmVuZXdhbHNbcmVzb3VyY2VdKSB7XG4gICAgICAvLyBBY3RpdmUgcmVuZXdhbHMgY29udGFpbnMgdGhlIHN0YXRlIGZvciBlYWNoIHJlbmV3YWwuXG4gICAgICB0aGlzLnJlZ2lzdGVyQ2FsbGJhY2sodGhpcy5fYWN0aXZlUmVuZXdhbHNbcmVzb3VyY2VdLCByZXNvdXJjZSwgY2FsbGJhY2spO1xuICAgIH0gZWxzZSBpZiAocmVzb3VyY2UgPT09IHRoaXMuY29uZmlnLmNsaWVudElkKSB7XG4gICAgICAvLyBBcHAgdXNlcyBpZHRva2VuIHRvIHNlbmQgdG8gYXBpIGVuZHBvaW50c1xuICAgICAgLy8gRGVmYXVsdCByZXNvdXJjZSBpcyB0cmFja2VkIGFzIGNsaWVudGlkIHRvIHN0b3JlIHRoaXMgdG9rZW5cbiAgICAgIHRoaXMudmVyYm9zZSgncmVuZXdpbmcgaWR0b2tlbicpO1xuICAgICAgdGhpcy5fcmVuZXdJZFRva2VuKGNhbGxiYWNrKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fcmVuZXdUb2tlbihyZXNvdXJjZSwgY2FsbGJhY2spO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZWRpcmVjdCB0aGUgQnJvd3NlciB0byBBenVyZSBBRCBBdXRob3JpemF0aW9uIGVuZHBvaW50XG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxOYXZpZ2F0ZSBUaGUgYXV0aG9yaXphdGlvbiByZXF1ZXN0IHVybFxuICAgKi9cbiAgcHJvbXB0VXNlcih1cmxOYXZpZ2F0ZSkge1xuICAgIGlmICh1cmxOYXZpZ2F0ZSkge1xuICAgICAgdGhpcy5pbmZvKCdOYXZpZ2F0ZSB0bzonICsgdXJsTmF2aWdhdGUpO1xuICAgICAgdGhpcy5uYXZpZ2F0ZSh1cmxOYXZpZ2F0ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaW5mbygnTmF2aWdhdGUgdXJsIGlzIGVtcHR5Jyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGNhY2hlIGl0ZW1zLlxuICAgKi9cbiAgY2xlYXJDYWNoZSgpIHtcbiAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkFDQ0VTU19UT0tFTl9LRVksICcnKTtcbiAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVYUElSQVRJT05fS0VZLCAwKTtcbiAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlNFU1NJT05fU1RBVEUsICcnKTtcbiAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlNUQVRFX0xPR0lOLCAnJyk7XG4gICAgdGhpcy5fcmVuZXdTdGF0ZXMgPSBbXTtcbiAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlVTRVJOQU1FLCAnJyk7XG4gICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5JRFRPS0VOLCAnJyk7XG4gICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUiwgJycpO1xuICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1JfREVTQ1JJUFRJT04sICcnKTtcbiAgICBsZXQga2V5cyA9IHRoaXMuX2dldEl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5UT0tFTl9LRVlTKTtcblxuICAgIGlmICghdGhpcy5faXNFbXB0eShrZXlzKSkge1xuICAgICAga2V5cyA9IGtleXMuc3BsaXQodGhpcy5DT05TVEFOVFMuUkVTT1VSQ0VfREVMSU1FVEVSKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkFDQ0VTU19UT0tFTl9LRVkgKyBrZXlzW2ldLCAnJyk7XG4gICAgICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVhQSVJBVElPTl9LRVkgKyBrZXlzW2ldLCAwKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5UT0tFTl9LRVlTLCAnJyk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgY2FjaGUgaXRlbXMgZm9yIGEgcmVzb3VyY2UuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByZXNvdXJjZSBUaGUgcmVzb3VyY2VcbiAgICovXG4gIGNsZWFyQ2FjaGVGb3JSZXNvdXJjZShyZXNvdXJjZSkge1xuICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuU1RBVEVfUkVORVcsICcnKTtcbiAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVSUk9SLCAnJyk7XG4gICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUl9ERVNDUklQVElPTiwgJycpO1xuICAgIGlmICh0aGlzLl9oYXNSZXNvdXJjZShyZXNvdXJjZSkpIHtcbiAgICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuQUNDRVNTX1RPS0VOX0tFWSArIHJlc291cmNlLCAnJyk7XG4gICAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVYUElSQVRJT05fS0VZICsgcmVzb3VyY2UsIDApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2dvdXQgdXNlciB3aWxsIHJlZGlyZWN0IHBhZ2UgdG8gbG9nb3V0IGVuZHBvaW50LlxuICAgKiBBZnRlciBsb2dvdXQsIGl0IHdpbGwgcmVkaXJlY3QgdG8gcG9zdF9sb2dvdXQgcGFnZSBpZiBwcm92aWRlZC5cbiAgICovXG4gIGxvZ091dCgpIHtcbiAgICB0aGlzLmNsZWFyQ2FjaGUoKTtcbiAgICBsZXQgbG9nb3V0ID0gJyc7XG4gICAgdGhpcy5fdXNlciA9IG51bGw7XG5cbiAgICBpZiAodGhpcy5jb25maWcucG9zdExvZ291dFJlZGlyZWN0VXJpKSB7XG4gICAgICBsb2dvdXQgPSAncG9zdF9sb2dvdXRfcmVkaXJlY3RfdXJpPScgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5jb25maWcucG9zdExvZ291dFJlZGlyZWN0VXJpKTtcbiAgICB9XG5cbiAgICBjb25zdCB1cmxOYXZpZ2F0ZSA9IHRoaXMuY29uZmlnLnVybCArICdsb2dvdXQ/JyArIGxvZ291dDtcbiAgICB0aGlzLmluZm8oJ0xvZ291dCBuYXZpZ2F0ZSB0bzogJyArIHVybE5hdmlnYXRlKTtcbiAgICB0aGlzLnByb21wdFVzZXIodXJsTmF2aWdhdGUpO1xuICB9XG5cbiAgX2lzRW1wdHkoc3RyKSB7XG4gICAgcmV0dXJuICh0eXBlb2Ygc3RyID09PSAndW5kZWZpbmVkJyB8fCAhc3RyIHx8IHN0ci5sZW5ndGggPT09IDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYSB1c2VyIHByb2ZpbGVcbiAgICogQHBhcmFtIHtyZXF1ZXN0Q2FsbGJhY2t9IGNhbGxiYWNrIFRoZSBjYWxsYmFjayB0aGF0IGhhbmRsZXMgdGhlIHJlc3BvbnNlLlxuICAgKi9cbiAgZ2V0VXNlcihjYWxsYmFjaykge1xuICAgIC8vIElEVG9rZW4gaXMgZmlyc3QgY2FsbFxuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignY2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24nKTtcbiAgICB9XG5cbiAgICAvLyB1c2VyIGluIG1lbW9yeVxuICAgIGlmICh0aGlzLl91c2VyKSB7XG4gICAgICBjYWxsYmFjayhudWxsLCB0aGlzLl91c2VyKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBmcmFtZSBpcyB1c2VkIHRvIGdldCBpZHRva2VuXG4gICAgY29uc3QgaWR0b2tlbiA9IHRoaXMuX2dldEl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5JRFRPS0VOKTtcbiAgICBpZiAodGhpcy5faXNFbXB0eShpZHRva2VuKSkge1xuICAgICAgdGhpcy53YXJuKCdVc2VyIGluZm9ybWF0aW9uIGlzIG5vdCBhdmFpbGFibGUnKTtcbiAgICAgIGNhbGxiYWNrKCdVc2VyIGluZm9ybWF0aW9uIGlzIG5vdCBhdmFpbGFibGUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pbmZvKCdVc2VyIGV4aXN0cyBpbiBjYWNoZTogJyk7XG4gICAgICB0aGlzLl91c2VyID0gdGhpcy5fY3JlYXRlVXNlcihpZHRva2VuKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHRoaXMuX3VzZXIpO1xuICAgIH1cbiAgfVxuXG4gIF9hZGRIaW50UGFyYW1ldGVycyh1cmxOYXZpZ2F0ZSkge1xuICAgIC8vIGluY2x1ZGUgaGludCBwYXJhbXMgb25seSBpZiB1cG4gaXMgcHJlc2VudFxuICAgIGlmICh0aGlzLl91c2VyICYmIHRoaXMuX3VzZXIucHJvZmlsZSAmJiB0aGlzLl91c2VyLnByb2ZpbGUuaGFzT3duUHJvcGVydHkoJ3VwbicpKSB7XG4gICAgICAvLyBhZGQgbG9naW5faGludFxuICAgICAgdXJsTmF2aWdhdGUgKz0gJyZsb2dpbl9oaW50PScgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5fdXNlci5wcm9maWxlLnVwbik7XG5cbiAgICAgIC8vIGRvbid0IGFkZCBkb21haW5faGludCB0d2ljZSBpZiB1c2VyIHByb3ZpZGVkIGl0IGluIHRoZSBleHRyYVF1ZXJ5UGFyYW1ldGVyIHZhbHVlXG4gICAgICBpZiAoIXRoaXMuX3VybENvbnRhaW5zUXVlcnlTdHJpbmdQYXJhbWV0ZXIoJ2RvbWFpbl9oaW50JywgdXJsTmF2aWdhdGUpICYmIHRoaXMuX3VzZXIucHJvZmlsZS51cG4uaW5kZXhPZignQCcpID4gLTEpIHtcbiAgICAgICAgY29uc3QgcGFydHMgPSB0aGlzLl91c2VyLnByb2ZpbGUudXBuLnNwbGl0KCdAJyk7XG4gICAgICAgIC8vIGxvY2FsIHBhcnQgY2FuIGluY2x1ZGUgQCBpbiBxdW90ZXMuIFNlbmRpbmcgbGFzdCBwYXJ0IGhhbmRsZXMgdGhhdC5cbiAgICAgICAgdXJsTmF2aWdhdGUgKz0gJyZkb21haW5faGludD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHBhcnRzW3BhcnRzLmxlbmd0aCAtIDFdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdXJsTmF2aWdhdGU7XG4gIH1cblxuICBfY3JlYXRlVXNlcihpZFRva2VuKSB7XG4gICAgbGV0IHVzZXIgPSBudWxsO1xuICAgIGNvbnN0IHBhcnNlZEpzb24gPSB0aGlzLl9leHRyYWN0SWRUb2tlbihpZFRva2VuKTtcbiAgICBpZiAocGFyc2VkSnNvbiAmJiBwYXJzZWRKc29uLmhhc093blByb3BlcnR5KCdhdWQnKSkge1xuICAgICAgbGV0IGF1ZGllbmNlTWF0Y2ggPSBmYWxzZTtcblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFyc2VkSnNvbi5hdWQpKSB7XG4gICAgICAgIC8vIElmIHRoZSBJRCBUb2tlbiBjb250YWlucyBtdWx0aXBsZSBhdWRpZW5jZXMgdGhlbiBhbiBhenAgY2xhaW0gbXVzdCBiZSBwcmVzZW50IGFuZCBlcXVhbCB0byB0aGUgY2xpZW50IGlkLlxuICAgICAgICBpZiAocGFyc2VkSnNvbi5oYXNPd25Qcm9wZXJ0eSgnYXpwJykgJiYgcGFyc2VkSnNvbi5henAudG9Mb3dlckNhc2UoKSA9PT0gdGhpcy5jb25maWcuY2xpZW50SWQudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFyc2VkSnNvbi5hdWQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChwYXJzZWRKc29uLmF1ZFtpXS50b0xvd2VyQ2FzZSgpID09PSB0aGlzLmNvbmZpZy5jbGllbnRJZC50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICAgIGF1ZGllbmNlTWF0Y2ggPSB0cnVlO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF1ZGllbmNlTWF0Y2ggPSAocGFyc2VkSnNvbi5hdWQudG9Mb3dlckNhc2UoKSA9PT0gdGhpcy5jb25maWcuY2xpZW50SWQudG9Mb3dlckNhc2UoKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChhdWRpZW5jZU1hdGNoKSB7XG4gICAgICAgIHVzZXIgPSB7XG4gICAgICAgICAgdXNlck5hbWU6ICcnLFxuICAgICAgICAgIHByb2ZpbGU6IHBhcnNlZEpzb25cbiAgICAgICAgfTtcblxuICAgICAgICBpZiAocGFyc2VkSnNvbi5oYXNPd25Qcm9wZXJ0eSgndXBuJykpIHtcbiAgICAgICAgICB1c2VyLnVzZXJOYW1lID0gcGFyc2VkSnNvbi51cG47XG4gICAgICAgIH0gZWxzZSBpZiAocGFyc2VkSnNvbi5oYXNPd25Qcm9wZXJ0eSgnZW1haWwnKSkge1xuICAgICAgICAgIHVzZXIudXNlck5hbWUgPSBwYXJzZWRKc29uLmVtYWlsO1xuICAgICAgICB9IGVsc2UgaWYgKHBhcnNlZEpzb24uaGFzT3duUHJvcGVydHkoJ3N1YicpKSB7XG4gICAgICAgICAgdXNlci51c2VyTmFtZSA9IHBhcnNlZEpzb24uc3ViO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLndhcm4oJ0lkVG9rZW4gaGFzIGludmFsaWQgYXVkL2F6cCBmaWVsZCcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB1c2VyO1xuICB9XG5cbiAgX2dldEhhc2goaGFzaCkge1xuICAgIGNvbnN0IG1hcmtlciA9ICcjJyArIHRoaXMuY29uZmlnLmhhc2hQcmVmaXggKyAnLyc7XG4gICAgaGFzaCA9ICgoaGFzaC5sYXN0SW5kZXhPZihtYXJrZXIpID4gLTEpID8gaGFzaC5zdWJzdHJpbmcoaGFzaC5sYXN0SW5kZXhPZihtYXJrZXIpICsgdGhpcy5jb25maWcuaGFzaFByZWZpeC5sZW5ndGggKyAyKSA6IGhhc2gpO1xuICAgIGhhc2ggPSAoKGhhc2gubGFzdEluZGV4T2YoJyMvJykgPiAtMSkgPyBoYXNoLnN1YnN0cmluZyhoYXNoLmxhc3RJbmRleE9mKCcjLycpICsgMikgOiBoYXNoKTtcbiAgICBoYXNoID0gKChoYXNoLmxhc3RJbmRleE9mKCcjJykgPiAtMSkgPyBoYXNoLnN1YnN0cmluZyhoYXNoLmxhc3RJbmRleE9mKCcjJykgKyAxKSA6IGhhc2gpO1xuXG4gICAgcmV0dXJuIGhhc2g7XG4gIH1cblxuICBfZ2V0U2VhcmNoKHNlYXJjaCkge1xuICAgIGNvbnN0IGluZGV4ID0gc2VhcmNoLmluZGV4T2YoJz8nKTtcbiAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgc2VhcmNoID0gc2VhcmNoLnN1YnN0cmluZyhpbmRleCArIDEpO1xuICAgIH1cblxuICAgIHJldHVybiBzZWFyY2g7XG4gIH1cblxuICBfZ2V0UGFyYW1ldGVycyhoYXNoLCBzZWFyY2gpIHtcbiAgICBsZXQgcGFyYW1ldGVycyA9IHt9O1xuXG4gICAgaWYgKGhhc2gpIHtcbiAgICAgIGhhc2ggPSB0aGlzLl9nZXRIYXNoKGhhc2gpO1xuICAgICAgcGFyYW1ldGVycyA9IHRoaXMuX2Rlc2VyaWFsaXplKGhhc2gpO1xuICAgIH1cblxuICAgIGlmIChzZWFyY2gpIHtcbiAgICAgIHNlYXJjaCA9IHRoaXMuX2dldFNlYXJjaChzZWFyY2gpO1xuICAgICAgY29uc3Qgc2VhcmNoUGFyYW1ldGVycyA9IHRoaXMuX2Rlc2VyaWFsaXplKHNlYXJjaCk7XG4gICAgICBwYXJhbWV0ZXJzID0gdGhpcy5fZXh0ZW5kKHBhcmFtZXRlcnMsIHNlYXJjaFBhcmFtZXRlcnMpO1xuICAgIH1cblxuICAgIHJldHVybiBwYXJhbWV0ZXJzO1xuICB9XG5cbiAgX2V4dGVuZChvYmosIHNyYykge1xuICAgIGZvciAoY29uc3Qga2V5IGluIHNyYykge1xuICAgICAgaWYgKHNyYy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgIG9ialtrZXldID0gc3JjW2tleV07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGhhc2ggY29udGFpbnMgYWNjZXNzIHRva2VuIG9yIGlkIHRva2VuIG9yIGVycm9yX2Rlc2NyaXB0aW9uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBoYXNoICAtICBIYXNoIHBhc3NlZCBmcm9tIHJlZGlyZWN0IHBhZ2VcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlYXJjaCAgLSAgU2VhcmNoIHBhc3NlZCBmcm9tIHJlZGlyZWN0IHBhZ2VcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gZXhpc3RzIGlmIGFsbCB0aGUgcGFyYW1ldGVycyBleGlzdFxuICAgKi9cbiAgaXNDYWxsYmFjayhoYXNoLCBzZWFyY2gpIHtcbiAgICBjb25zdCBwYXJhbWV0ZXJzID0gdGhpcy5fZ2V0UGFyYW1ldGVycyhoYXNoLCBzZWFyY2gpO1xuXG4gICAgcmV0dXJuIHBhcmFtZXRlcnMuaGFzT3duUHJvcGVydHkodGhpcy5DT05TVEFOVFMuRVJST1JfREVTQ1JJUFRJT04pIHx8XG4gICAgICBwYXJhbWV0ZXJzLmhhc093blByb3BlcnR5KHRoaXMuQ09OU1RBTlRTLkFDQ0VTU19UT0tFTikgfHxcbiAgICAgIHBhcmFtZXRlcnMuaGFzT3duUHJvcGVydHkodGhpcy5DT05TVEFOVFMuSURfVE9LRU4pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgbG9naW4gZXJyb3JcbiAgICogQHJldHVybiB7c3RyaW5nfSBlcnJvciBtZXNzYWdlIHJlbGF0ZWQgdG8gbG9naW5cbiAgICovXG4gIGdldExvZ2luRXJyb3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2dldEl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5MT0dJTl9FUlJPUik7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyByZXF1ZXN0SW5mbyBmcm9tIGdpdmVuIGhhc2guXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBoYXNoICAtICBIYXNoIHBhc3NlZCBmcm9tIHJlZGlyZWN0IHBhZ2VcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlYXJjaCAgLSAgU2VhcmNoIHBhc3NlZCBmcm9tIHJlZGlyZWN0IHBhZ2VcbiAgICogQHJldHVybiB7c3RyaW5nfSBlcnJvciBtZXNzYWdlIHJlbGF0ZWQgdG8gbG9naW5cbiAgICovXG4gIGdldFJlcXVlc3RJbmZvKGhhc2gsIHNlYXJjaCkge1xuICAgIGNvbnN0IHBhcmFtZXRlcnMgPSB0aGlzLl9nZXRQYXJhbWV0ZXJzKGhhc2gsIHNlYXJjaCk7XG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB7XG4gICAgICB2YWxpZDogZmFsc2UsXG4gICAgICBwYXJhbWV0ZXJzOiB7fSxcbiAgICAgIHN0YXRlTWF0Y2g6IGZhbHNlLFxuICAgICAgc3RhdGVSZXNwb25zZTogJycsXG4gICAgICByZXF1ZXN0VHlwZTogdGhpcy5SRVFVRVNUX1RZUEUuVU5LTk9XTlxuICAgIH07XG5cbiAgICBpZiAocGFyYW1ldGVycykge1xuICAgICAgcmVxdWVzdEluZm8ucGFyYW1ldGVycyA9IHBhcmFtZXRlcnM7XG4gICAgICBpZiAocGFyYW1ldGVycy5oYXNPd25Qcm9wZXJ0eSh0aGlzLkNPTlNUQU5UUy5FUlJPUl9ERVNDUklQVElPTikgfHxcbiAgICAgICAgcGFyYW1ldGVycy5oYXNPd25Qcm9wZXJ0eSh0aGlzLkNPTlNUQU5UUy5BQ0NFU1NfVE9LRU4pIHx8XG4gICAgICAgIHBhcmFtZXRlcnMuaGFzT3duUHJvcGVydHkodGhpcy5DT05TVEFOVFMuSURfVE9LRU4pKSB7XG4gICAgICAgIHJlcXVlc3RJbmZvLnZhbGlkID0gdHJ1ZTtcblxuICAgICAgICAvLyB3aGljaCBjYWxsXG4gICAgICAgIGxldCBzdGF0ZVJlc3BvbnNlID0gJyc7XG4gICAgICAgIGlmIChwYXJhbWV0ZXJzLmhhc093blByb3BlcnR5KCdzdGF0ZScpKSB7XG4gICAgICAgICAgdGhpcy52ZXJib3NlKCdTdGF0ZTogJyArIHBhcmFtZXRlcnMuc3RhdGUpO1xuICAgICAgICAgIHN0YXRlUmVzcG9uc2UgPSBwYXJhbWV0ZXJzLnN0YXRlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMud2FybignTm8gc3RhdGUgcmV0dXJuZWQnKTtcbiAgICAgICAgICByZXR1cm4gcmVxdWVzdEluZm87XG4gICAgICAgIH1cblxuICAgICAgICByZXF1ZXN0SW5mby5zdGF0ZVJlc3BvbnNlID0gc3RhdGVSZXNwb25zZTtcblxuICAgICAgICAvLyBhc3luYyBjYWxscyBjYW4gZmlyZSBpZnJhbWUgYW5kIGxvZ2luIHJlcXVlc3QgYXQgdGhlIHNhbWUgdGltZSBpZiBkZXZlbG9wZXIgZG9lcyBub3QgdXNlIHRoZSBBUEkgYXMgZXhwZWN0ZWRcbiAgICAgICAgLy8gaW5jb21pbmcgY2FsbGJhY2sgbmVlZHMgdG8gYmUgbG9va2VkIHVwIHRvIGZpbmQgdGhlIHJlcXVlc3QgdHlwZVxuICAgICAgICBpZiAoc3RhdGVSZXNwb25zZSA9PT0gdGhpcy5fZ2V0SXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlNUQVRFX0xPR0lOKSkge1xuICAgICAgICAgIHJlcXVlc3RJbmZvLnJlcXVlc3RUeXBlID0gdGhpcy5SRVFVRVNUX1RZUEUuTE9HSU47XG4gICAgICAgICAgcmVxdWVzdEluZm8uc3RhdGVNYXRjaCA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuIHJlcXVlc3RJbmZvO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZXh0ZXJuYWwgYXBpIHJlcXVlc3RzIG1heSBoYXZlIG1hbnkgcmVuZXd0b2tlbiByZXF1ZXN0cyBmb3IgZGlmZmVyZW50IHJlc291cmNlXG4gICAgICAgIGlmICghcmVxdWVzdEluZm8uc3RhdGVNYXRjaCAmJiB3aW5kb3cucGFyZW50ICYmIHdpbmRvdy5wYXJlbnQuQXV0aGVudGljYXRpb25Db250ZXh0KSB7XG4gICAgICAgICAgY29uc3Qgc3RhdGVzSW5QYXJlbnRDb250ZXh0ID0gd2luZG93LnBhcmVudC5BdXRoZW50aWNhdGlvbkNvbnRleHQuX3JlbmV3U3RhdGVzO1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RhdGVzSW5QYXJlbnRDb250ZXh0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoc3RhdGVzSW5QYXJlbnRDb250ZXh0W2ldID09PSByZXF1ZXN0SW5mby5zdGF0ZVJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgIHJlcXVlc3RJbmZvLnJlcXVlc3RUeXBlID0gdGhpcy5SRVFVRVNUX1RZUEUuUkVORVdfVE9LRU47XG4gICAgICAgICAgICAgIHJlcXVlc3RJbmZvLnN0YXRlTWF0Y2ggPSB0cnVlO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVxdWVzdEluZm87XG4gIH1cblxuICBfZ2V0UmVzb3VyY2VGcm9tU3RhdGUoc3RhdGUpIHtcbiAgICBpZiAoc3RhdGUpIHtcbiAgICAgIGNvbnN0IHNwbGl0SW5kZXggPSBzdGF0ZS5pbmRleE9mKCd8Jyk7XG4gICAgICBpZiAoc3BsaXRJbmRleCA+IC0xICYmIHNwbGl0SW5kZXggKyAxIDwgc3RhdGUubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5zdWJzdHJpbmcoc3BsaXRJbmRleCArIDEpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIC8qKlxuICAgKiBTYXZlcyB0b2tlbiBmcm9tIGhhc2ggdGhhdCBpcyByZWNlaXZlZCBmcm9tIHJlZGlyZWN0LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcmVxdWVzdEluZm8gSGFzaCBwYXNzZWQgZnJvbSByZWRpcmVjdCBwYWdlXG4gICAqL1xuICBzYXZlVG9rZW5Gcm9tSGFzaChyZXF1ZXN0SW5mbykge1xuICAgIHRoaXMuaW5mbygnU3RhdGUgc3RhdHVzOicgKyByZXF1ZXN0SW5mby5zdGF0ZU1hdGNoICsgJzsgUmVxdWVzdCB0eXBlOicgKyByZXF1ZXN0SW5mby5yZXF1ZXN0VHlwZSk7XG4gICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUiwgJycpO1xuICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1JfREVTQ1JJUFRJT04sICcnKTtcblxuICAgIGxldCByZXNvdXJjZSA9IHRoaXMuX2dldFJlc291cmNlRnJvbVN0YXRlKHJlcXVlc3RJbmZvLnN0YXRlUmVzcG9uc2UpO1xuXG4gICAgLy8gUmVjb3JkIGVycm9yXG4gICAgaWYgKHJlcXVlc3RJbmZvLnBhcmFtZXRlcnMuaGFzT3duUHJvcGVydHkodGhpcy5DT05TVEFOVFMuRVJST1JfREVTQ1JJUFRJT04pKSB7XG4gICAgICB0aGlzLmluZm8oJ0Vycm9yIDonICsgcmVxdWVzdEluZm8ucGFyYW1ldGVycy5lcnJvciArICc7IEVycm9yIGRlc2NyaXB0aW9uOicgKyByZXF1ZXN0SW5mby5wYXJhbWV0ZXJzW3RoaXMuQ09OU1RBTlRTLkVSUk9SX0RFU0NSSVBUSU9OXSk7XG4gICAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVSUk9SLCByZXF1ZXN0SW5mby5wYXJhbWV0ZXJzLmVycm9yKTtcbiAgICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1JfREVTQ1JJUFRJT04sIHJlcXVlc3RJbmZvLnBhcmFtZXRlcnNbdGhpcy5DT05TVEFOVFMuRVJST1JfREVTQ1JJUFRJT05dKTtcblxuICAgICAgaWYgKHJlcXVlc3RJbmZvLnJlcXVlc3RUeXBlID09PSB0aGlzLlJFUVVFU1RfVFlQRS5MT0dJTikge1xuICAgICAgICB0aGlzLl9sb2dpbkluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5MT0dJTl9FUlJPUiwgcmVxdWVzdEluZm8ucGFyYW1ldGVycy5lcnJvcl9kZXNjcmlwdGlvbik7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChyZXF1ZXN0SW5mby5zdGF0ZU1hdGNoKSB7XG4gICAgICAvLyByZWNvcmQgdG9rZW5zIHRvIHN0b3JhZ2UgaWYgZXhpc3RzXG4gICAgICB0aGlzLmluZm8oJ1N0YXRlIGlzIHJpZ2h0Jyk7XG4gICAgICBpZiAocmVxdWVzdEluZm8ucGFyYW1ldGVycy5oYXNPd25Qcm9wZXJ0eSh0aGlzLkNPTlNUQU5UUy5TRVNTSU9OX1NUQVRFKSkge1xuICAgICAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlNFU1NJT05fU1RBVEUsIHJlcXVlc3RJbmZvLnBhcmFtZXRlcnNbdGhpcy5DT05TVEFOVFMuU0VTU0lPTl9TVEFURV0pO1xuICAgICAgfVxuXG4gICAgICBsZXQga2V5cztcblxuICAgICAgaWYgKHJlcXVlc3RJbmZvLnBhcmFtZXRlcnMuaGFzT3duUHJvcGVydHkodGhpcy5DT05TVEFOVFMuQUNDRVNTX1RPS0VOKSkge1xuICAgICAgICB0aGlzLmluZm8oJ0ZyYWdtZW50IGhhcyBhY2Nlc3MgdG9rZW4nKTtcblxuICAgICAgICBpZiAoIXRoaXMuX2hhc1Jlc291cmNlKHJlc291cmNlKSkge1xuICAgICAgICAgIGtleXMgPSB0aGlzLl9nZXRJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuVE9LRU5fS0VZUykgfHwgJyc7XG4gICAgICAgICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5UT0tFTl9LRVlTLCBrZXlzICsgcmVzb3VyY2UgKyB0aGlzLkNPTlNUQU5UUy5SRVNPVVJDRV9ERUxJTUVURVIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHNhdmUgdG9rZW4gd2l0aCByZWxhdGVkIHJlc291cmNlXG4gICAgICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuQUNDRVNTX1RPS0VOX0tFWSArIHJlc291cmNlLCByZXF1ZXN0SW5mby5wYXJhbWV0ZXJzW3RoaXMuQ09OU1RBTlRTLkFDQ0VTU19UT0tFTl0pO1xuICAgICAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVYUElSQVRJT05fS0VZICsgcmVzb3VyY2UsIHRoaXMuX2V4cGlyZXNJbihyZXF1ZXN0SW5mby5wYXJhbWV0ZXJzW3RoaXMuQ09OU1RBTlRTLkVYUElSRVNfSU5dKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChyZXF1ZXN0SW5mby5wYXJhbWV0ZXJzLmhhc093blByb3BlcnR5KHRoaXMuQ09OU1RBTlRTLklEX1RPS0VOKSkge1xuICAgICAgICB0aGlzLmluZm8oJ0ZyYWdtZW50IGhhcyBpZCB0b2tlbicpO1xuICAgICAgICB0aGlzLl9sb2dpbkluUHJvZ3Jlc3MgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLl91c2VyID0gdGhpcy5fY3JlYXRlVXNlcihyZXF1ZXN0SW5mby5wYXJhbWV0ZXJzW3RoaXMuQ09OU1RBTlRTLklEX1RPS0VOXSk7XG5cbiAgICAgICAgaWYgKHRoaXMuX3VzZXIgJiYgdGhpcy5fdXNlci5wcm9maWxlKSB7XG4gICAgICAgICAgaWYgKHRoaXMuX3VzZXIucHJvZmlsZS5ub25jZSA9PT0gdGhpcy5fZ2V0SXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLk5PTkNFX0lEVE9LRU4pKSB7XG4gICAgICAgICAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLklEVE9LRU4sIHJlcXVlc3RJbmZvLnBhcmFtZXRlcnNbdGhpcy5DT05TVEFOVFMuSURfVE9LRU5dKTtcblxuICAgICAgICAgICAgLy8gU2F2ZSBpZHRva2VuIGFzIGFjY2VzcyB0b2tlbiBmb3IgYXBwIGl0c2VsZlxuICAgICAgICAgICAgcmVzb3VyY2UgPSB0aGlzLmNvbmZpZy5sb2dpblJlc291cmNlID8gdGhpcy5jb25maWcubG9naW5SZXNvdXJjZSA6IHRoaXMuY29uZmlnLmNsaWVudElkO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuX2hhc1Jlc291cmNlKHJlc291cmNlKSkge1xuICAgICAgICAgICAgICBrZXlzID0gdGhpcy5fZ2V0SXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlRPS0VOX0tFWVMpIHx8ICcnO1xuICAgICAgICAgICAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlRPS0VOX0tFWVMsIGtleXMgKyByZXNvdXJjZSArIHRoaXMuQ09OU1RBTlRTLlJFU09VUkNFX0RFTElNRVRFUik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkFDQ0VTU19UT0tFTl9LRVkgKyByZXNvdXJjZSwgcmVxdWVzdEluZm8ucGFyYW1ldGVyc1t0aGlzLkNPTlNUQU5UUy5JRF9UT0tFTl0pO1xuICAgICAgICAgICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FWFBJUkFUSU9OX0tFWSArIHJlc291cmNlLCB0aGlzLl91c2VyLnByb2ZpbGUuZXhwKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fdXNlciA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkxPR0lOX0VSUk9SLCAnTm9uY2UgaXMgbm90IHNhbWUgYXMgJyArIHRoaXMuX2lkVG9rZW5Ob25jZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1IsICdpbnZhbGlkIGlkX3Rva2VuJyk7XG4gICAgICAgICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUl9ERVNDUklQVElPTiwgJ0ludmFsaWQgaWRfdG9rZW4uIGlkX3Rva2VuOiAnICsgcmVxdWVzdEluZm8ucGFyYW1ldGVyc1t0aGlzLkNPTlNUQU5UUy5JRF9UT0tFTl0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1IsICdJbnZhbGlkX3N0YXRlJyk7XG4gICAgICB0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVSUk9SX0RFU0NSSVBUSU9OLCAnSW52YWxpZF9zdGF0ZS4gc3RhdGU6ICcgKyByZXF1ZXN0SW5mby5zdGF0ZVJlc3BvbnNlKTtcbiAgICB9XG4gICAgdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5SRU5FV19TVEFUVVMgKyByZXNvdXJjZSwgdGhpcy5DT05TVEFOVFMuVE9LRU5fUkVORVdfU1RBVFVTX0NPTVBMRVRFRCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyByZXNvdXJjZSBmb3IgZ2l2ZW4gZW5kcG9pbnQgaWYgbWFwcGluZyBpcyBwcm92aWRlZCB3aXRoIGNvbmZpZy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGVuZHBvaW50IEFQSSBlbmRwb2ludFxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IHJlc291cmNlIGZvciB0aGlzIEFQSSBlbmRwb2ludFxuICAgKi9cbiAgZ2V0UmVzb3VyY2VGb3JFbmRwb2ludChlbmRwb2ludCkge1xuICAgIGlmICh0aGlzLmNvbmZpZyAmJiB0aGlzLmNvbmZpZy5zZWN1cmVkRW5kcG9pbnRzKSB7XG4gICAgICBmb3IgKGNvbnN0IGNvbmZpZ0VuZHBvaW50IGluIHRoaXMuY29uZmlnLnNlY3VyZWRFbmRwb2ludHMpIHtcbiAgICAgICAgLy8gY29uZmlnRW5kcG9pbnQgaXMgbGlrZSAvYXBpL1RvZG8gcmVxdWVzdGVkIGVuZHBvaW50IGNhbiBiZSAvYXBpL1RvZG8vMVxuICAgICAgICBpZiAoZW5kcG9pbnQuaW5kZXhPZihjb25maWdFbmRwb2ludCkgPiAtMSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5zZWN1cmVkRW5kcG9pbnRzW2NvbmZpZ0VuZHBvaW50XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGRlZmF1bHQgcmVzb3VyY2Ugd2lsbCBiZSBjbGllbnRpZCBpZiBub3RoaW5nIHNwZWNpZmllZFxuICAgIC8vIEFwcCB3aWxsIHVzZSBpZHRva2VuIGZvciBjYWxscyB0byBpdHNlbGZcbiAgICAvLyBjaGVjayBpZiBpdCdzIHN0YXJpbmcgZnJvbSBodHRwIG9yIGh0dHBzLCBuZWVkcyB0byBtYXRjaCB3aXRoIGFwcCBob3N0XG4gICAgaWYgKGVuZHBvaW50LmluZGV4T2YoJ2h0dHA6Ly8nKSA+IC0xIHx8IGVuZHBvaW50LmluZGV4T2YoJ2h0dHBzOi8vJykgPiAtMSkge1xuICAgICAgaWYgKHRoaXMuX2dldEhvc3RGcm9tVXJpKGVuZHBvaW50KSA9PT0gdGhpcy5fZ2V0SG9zdEZyb21VcmkodGhpcy5jb25maWcucmVkaXJlY3RVcmkpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5sb2dpblJlc291cmNlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBpbiBhbmd1bGFyIGxldmVsLCB0aGUgdXJsIGZvciAkaHR0cCBpbnRlcmNlcHRvciBjYWxsIGNvdWxkIGJlIHJlbGF0aXZlIHVybCxcbiAgICAgIC8vIGlmIGl0J3MgcmVsYXRpdmUgY2FsbCwgd2UnbGwgdHJlYXQgaXQgYXMgYXBwIGJhY2tlbmQgY2FsbC5cbiAgICAgIC8vIGlmIHVzZXIgc3BlY2lmaWVkIGxpc3Qgb2YgYW5vbnltb3VzIGVuZHBvaW50cywgbm8gbmVlZCB0byBzZW5kIHRva2VuIHRvIHRoZXNlIGVuZHBvaW50cywgcmV0dXJuIG51bGwuXG4gICAgICBpZiAodGhpcy5jb25maWcgJiYgdGhpcy5jb25maWcuYW5vbnltb3VzRW5kcG9pbnRzKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5jb25maWcuYW5vbnltb3VzRW5kcG9pbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYgKGVuZHBvaW50LmluZGV4T2YodGhpcy5jb25maWcuYW5vbnltb3VzRW5kcG9pbnRzW2ldKSA+IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIGFsbCBvdGhlciBhcHAncyBiYWNrZW5kIGNhbGxzIGFyZSBzZWN1cmVkLlxuICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLmxvZ2luUmVzb3VyY2U7XG4gICAgfVxuXG4gICAgLy8gaWYgbm90IHRoZSBhcHAncyBvd24gYmFja2VuZCBvciBub3QgYSBkb21haW4gbGlzdGVkIGluIHRoZSBlbmRwb2ludHMgc3RydWN0dXJlXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBfZ2V0SG9zdEZyb21VcmkodXJpKSB7XG4gICAgLy8gcmVtb3ZlIGh0dHA6Ly8gb3IgaHR0cHM6Ly8gZnJvbSB1cmlcbiAgICBsZXQgZXh0cmFjdGVkVXJpID0gU3RyaW5nKHVyaSkucmVwbGFjZSgvXihodHRwcz86KVxcL1xcLy8sICcnKTtcblxuICAgIGV4dHJhY3RlZFVyaSA9IGV4dHJhY3RlZFVyaS5zcGxpdCgnLycpWzBdO1xuICAgIHJldHVybiBleHRyYWN0ZWRVcmk7XG4gIH1cblxuICAvKiBleHBvcnRlZCAgb2F1dGgyQ2FsbGJhY2sgKi9cbiAgaGFuZGxlV2luZG93Q2FsbGJhY2soaGFzaCwgc2VhcmNoKSB7XG4gICAgLy8gVGhpcyBpcyBmb3IgcmVndWxhciBqYXZhc2NyaXB0IHVzYWdlIGZvciByZWRpcmVjdCBoYW5kbGluZ1xuICAgIC8vIG5lZWQgdG8gbWFrZSBzdXJlIHRoaXMgaXMgZm9yIGNhbGxiYWNrXG4gICAgaWYgKCFoYXNoKSB7XG4gICAgICBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XG4gICAgfVxuXG4gICAgaWYgKCFzZWFyY2gpIHtcbiAgICAgIHNlYXJjaCA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2g7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNDYWxsYmFjayhoYXNoLCBzZWFyY2gpKSB7XG4gICAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMuZ2V0UmVxdWVzdEluZm8oaGFzaCwgc2VhcmNoKTtcbiAgICAgIHRoaXMuaW5mbygnUmV0dXJuZWQgZnJvbSByZWRpcmVjdCB1cmwnKTtcbiAgICAgIHRoaXMuc2F2ZVRva2VuRnJvbUhhc2gocmVxdWVzdEluZm8pO1xuICAgICAgbGV0IGNhbGxiYWNrID0gbnVsbDtcbiAgICAgIGlmICgocmVxdWVzdEluZm8ucmVxdWVzdFR5cGUgPT09IHRoaXMuUkVRVUVTVF9UWVBFLlJFTkVXX1RPS0VOKSAmJiB0aGlzLmlzSWZyYW1lKCkpIHtcbiAgICAgICAgLy8gaWZyYW1lIGNhbGwgYnV0IHNhbWUgc2luZ2xlIHBhZ2VcbiAgICAgICAgdGhpcy52ZXJib3NlKCdXaW5kb3cgaXMgaW4gaWZyYW1lJyk7XG4gICAgICAgIGNhbGxiYWNrID0gd2luZG93LnBhcmVudC5BdXRoZW50aWNhdGlvbkNvbnRleHQuY2FsbEJhY2tNYXBwZWRUb1JlbmV3U3RhdGVzW3JlcXVlc3RJbmZvLnN0YXRlUmVzcG9uc2VdO1xuICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICBjYWxsYmFjayh0aGlzLl9nZXRJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1JfREVTQ1JJUFRJT04pLCByZXF1ZXN0SW5mby5wYXJhbWV0ZXJzW3RoaXMuQ09OU1RBTlRTLkFDQ0VTU19UT0tFTl0gfHwgcmVxdWVzdEluZm8ucGFyYW1ldGVyc1t0aGlzLkNPTlNUQU5UUy5JRF9UT0tFTl0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gZWxzZSBpZiAocmVxdWVzdEluZm8ucmVxdWVzdFR5cGUgPT09IHRoaXMuUkVRVUVTVF9UWVBFLkxPR0lOKSB7XG4gICAgICAgIGNhbGxiYWNrID0gdGhpcy5jYWxsYmFjaztcbiAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgY2FsbGJhY2sodGhpcy5fZ2V0SXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVSUk9SX0RFU0NSSVBUSU9OKSwgcmVxdWVzdEluZm8ucGFyYW1ldGVyc1t0aGlzLkNPTlNUQU5UUy5JRF9UT0tFTl0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBObyBuZWVkIHRvIHJlZGlyZWN0IHVzZXIgaW4gY2FzZSBvZiBwb3B1cFxuICAgICAgaWYgKCF0aGlzLnBvcFVwKSB7XG4gICAgICAgIHRoaXMubmF2aWdhdGUodGhpcy5fZ2V0SXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkxPR0lOX1JFUVVFU1QpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBfZ2V0TmF2aWdhdGVVcmwocmVzcG9uc2VUeXBlLCByZXNvdXJjZSkge1xuICAgIGxldCB1cmxOYXZpZ2F0ZSA9IHRoaXMuY29uZmlnLnVybCArICdhdXRob3JpemUnICsgdGhpcy5fc2VyaWFsaXplKHJlc3BvbnNlVHlwZSwgdGhpcy5jb25maWcsIHJlc291cmNlKSArIHRoaXMuX2FkZExpYk1ldGFkYXRhKCk7XG4gICAgaWYgKHRoaXMuY29uZmlnLnNjb3BlKSB7XG4gICAgICB1cmxOYXZpZ2F0ZSArPSAnJnNjb3BlPScgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5jb25maWcuc2NvcGUpO1xuICAgIH1cbiAgICB0aGlzLmluZm8oJ05hdmlnYXRlIHVybDonICsgdXJsTmF2aWdhdGUpO1xuICAgIHJldHVybiB1cmxOYXZpZ2F0ZTtcbiAgfVxuXG4gIF9leHRyYWN0SWRUb2tlbihlbmNvZGVkSWRUb2tlbikge1xuICAgIC8vIGlkIHRva2VuIHdpbGwgYmUgZGVjb2RlZCB0byBnZXQgdGhlIHVzZXJuYW1lXG4gICAgY29uc3QgZGVjb2RlZFRva2VuID0gdGhpcy5fZGVjb2RlSnd0KGVuY29kZWRJZFRva2VuKTtcbiAgICBpZiAoIWRlY29kZWRUb2tlbikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGJhc2U2NElkVG9rZW4gPSBkZWNvZGVkVG9rZW4uSldTUGF5bG9hZDtcbiAgICAgIGNvbnN0IGJhc2U2NERlY29kZWQgPSB0aGlzLl9iYXNlNjREZWNvZGVTdHJpbmdVcmxTYWZlKGJhc2U2NElkVG9rZW4pO1xuICAgICAgaWYgKCFiYXNlNjREZWNvZGVkKSB7XG4gICAgICAgIHRoaXMuaW5mbygnVGhlIHJldHVybmVkIGlkX3Rva2VuIGNvdWxkIG5vdCBiZSBiYXNlNjQgdXJsIHNhZmUgZGVjb2RlZC4nKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBKU09OLnBhcnNlKGJhc2U2NERlY29kZWQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdGhpcy5lcnJvcignVGhlIHJldHVybmVkIGlkX3Rva2VuIGNvdWxkIG5vdCBiZSBkZWNvZGVkJywgZXJyKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIF9iYXNlNjREZWNvZGVTdHJpbmdVcmxTYWZlKGJhc2U2NElkVG9rZW4pIHtcbiAgICBiYXNlNjRJZFRva2VuID0gYmFzZTY0SWRUb2tlbi5yZXBsYWNlKC8tL2csICcrJykucmVwbGFjZSgvXy9nLCAnLycpO1xuICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHdpbmRvdy5hdG9iKGJhc2U2NElkVG9rZW4pKSk7XG4gIH1cblxuICAgIC8vIEF1dGgubm9kZSBqcyBjcmFjayBmdW5jdGlvblxuICBfZGVjb2RlSnd0KGp3dFRva2VuKSB7XG4gICAgaWYgKHRoaXMuX2lzRW1wdHkoand0VG9rZW4pKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBpZFRva2VuUGFydHNSZWdleCA9IC9eKFteXFwuXFxzXSopXFwuKFteXFwuXFxzXSspXFwuKFteXFwuXFxzXSopJC87XG5cbiAgICBjb25zdCBtYXRjaGVzID0gaWRUb2tlblBhcnRzUmVnZXguZXhlYyhqd3RUb2tlbik7XG4gICAgaWYgKCFtYXRjaGVzIHx8IG1hdGNoZXMubGVuZ3RoIDwgNCkge1xuICAgICAgdGhpcy53YXJuKCdUaGUgcmV0dXJuZWQgaWRfdG9rZW4gaXMgbm90IHBhcnNlYWJsZS4nKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGNyYWNrZWRUb2tlbiA9IHtcbiAgICAgIGhlYWRlcjogbWF0Y2hlc1sxXSxcbiAgICAgIEpXU1BheWxvYWQ6IG1hdGNoZXNbMl0sXG4gICAgICBKV1NTaWc6IG1hdGNoZXNbM11cbiAgICB9O1xuXG4gICAgcmV0dXJuIGNyYWNrZWRUb2tlbjtcbiAgfVxuXG4gIF9jb252ZXJ0VXJsU2FmZVRvUmVndWxhckJhc2U2NEVuY29kZWRTdHJpbmcoc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKCctJywgJysnKS5yZXBsYWNlKCdfJywgJy8nKTtcbiAgfVxuXG4gIF9zZXJpYWxpemUocmVzcG9uc2VUeXBlLCBvYmosIHJlc291cmNlKSB7XG4gICAgY29uc3Qgc3RyID0gW107XG4gICAgaWYgKG9iaiAhPT0gbnVsbCkge1xuICAgICAgc3RyLnB1c2goJz9yZXNwb25zZV90eXBlPScgKyBlbmNvZGVVUklDb21wb25lbnQocmVzcG9uc2VUeXBlKSk7XG4gICAgICBzdHIucHVzaCgnY2xpZW50X2lkPScgKyBlbmNvZGVVUklDb21wb25lbnQob2JqLmNsaWVudElkKSk7XG4gICAgICBpZiAocmVzb3VyY2UpIHtcbiAgICAgICAgc3RyLnB1c2goJ3Jlc291cmNlPScgKyBlbmNvZGVVUklDb21wb25lbnQocmVzb3VyY2UpKTtcbiAgICAgIH1cblxuICAgICAgc3RyLnB1c2goJ3JlZGlyZWN0X3VyaT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KG9iai5yZWRpcmVjdFVyaSkpO1xuICAgICAgc3RyLnB1c2goJ3N0YXRlPScgKyBlbmNvZGVVUklDb21wb25lbnQob2JqLnN0YXRlKSk7XG5cbiAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoJ3NsaWNlJykpIHtcbiAgICAgICAgc3RyLnB1c2goJ3NsaWNlPScgKyBlbmNvZGVVUklDb21wb25lbnQob2JqLnNsaWNlKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoJ2V4dHJhUXVlcnlQYXJhbWV0ZXInKSkge1xuICAgICAgICBzdHIucHVzaChvYmouZXh0cmFRdWVyeVBhcmFtZXRlcik7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNvcnJlbGF0aW9uSWQgPSBvYmouY29ycmVsYXRpb25JZCA/IG9iai5jb3JyZWxhdGlvbklkIDogdXVpZC52NCgpO1xuICAgICAgc3RyLnB1c2goJ2NsaWVudC1yZXF1ZXN0LWlkPScgKyBlbmNvZGVVUklDb21wb25lbnQoY29ycmVsYXRpb25JZCkpO1xuICAgIH1cblxuICAgIHJldHVybiBzdHIuam9pbignJicpO1xuICB9XG5cbiAgX2Rlc2VyaWFsaXplKHF1ZXJ5KSB7XG4gICAgY29uc3QgcGwgPSAvXFwrL2c7IC8vIFJlZ2V4IGZvciByZXBsYWNpbmcgYWRkaXRpb24gc3ltYm9sIHdpdGggYSBzcGFjZVxuICAgIGNvbnN0IHNlYXJjaCA9IC8oW14mPV0rKT0oW14mXSopL2c7XG4gICAgY29uc3QgZGVjb2RlID0gKHMpID0+IHtcbiAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocy5yZXBsYWNlKHBsLCAnICcpKTtcbiAgICB9O1xuICAgIGNvbnN0IG9iaiA9IHt9O1xuICAgIGxldCBtYXRjaCA9IHNlYXJjaC5leGVjKHF1ZXJ5KTtcbiAgICB3aGlsZSAobWF0Y2gpIHtcbiAgICAgIG9ialtkZWNvZGUobWF0Y2hbMV0pXSA9IGRlY29kZShtYXRjaFsyXSk7XG4gICAgICBtYXRjaCA9IHNlYXJjaC5leGVjKHF1ZXJ5KTtcbiAgICB9XG5cbiAgICByZXR1cm4gb2JqO1xuICB9XG5cbiAgX2RlY2ltYWxUb0hleChudW1iZXIpIHtcbiAgICBsZXQgaGV4ID0gbnVtYmVyLnRvU3RyaW5nKDE2KTtcbiAgICB3aGlsZSAoaGV4Lmxlbmd0aCA8IDIpIHtcbiAgICAgIGhleCA9ICcwJyArIGhleDtcbiAgICB9XG4gICAgcmV0dXJuIGhleDtcbiAgfVxuXG4gIF9leHBpcmVzSW4oZXhwaXJlcykge1xuICAgIHJldHVybiB0aGlzLl9ub3coKSArIHBhcnNlSW50KGV4cGlyZXMsIDEwKTtcbiAgfVxuXG4gIF9ub3coKSB7XG4gICAgcmV0dXJuIE1hdGgucm91bmQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwLjApO1xuICB9XG5cbiAgX2FkZEF1dGhGcmFtZShpZnJhbWVJZCkge1xuICAgIGlmICh0eXBlb2YgaWZyYW1lSWQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5pbmZvKCdBZGQgYXV0aCBmcmFtZSB0byBkb2N1bWVudDonICsgaWZyYW1lSWQpO1xuICAgIGxldCBhdXRoRnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZnJhbWVJZCk7XG5cbiAgICBpZiAoIWF1dGhGcmFtZSkge1xuICAgICAgaWYgKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmXG4gICAgICAgICAgICAgICAgKHdpbmRvdy5vcGVyYSB8fCB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdNU0lFIDUuMCcpID09PSAtMSkpIHtcbiAgICAgICAgY29uc3QgaWZyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgICAgIGlmci5zZXRBdHRyaWJ1dGUoJ2lkJywgaWZyYW1lSWQpO1xuICAgICAgICBpZnIuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xuICAgICAgICBpZnIuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgICAgICBpZnIuc3R5bGUud2lkdGggPSBpZnIuc3R5bGUuaGVpZ2h0ID0gaWZyLmJvcmRlcldpZHRoID0gJzBweCc7XG5cbiAgICAgICAgYXV0aEZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5hcHBlbmRDaGlsZChpZnIpO1xuICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5ib2R5ICYmIGRvY3VtZW50LmJvZHkuaW5zZXJ0QWRqYWNlbnRIVE1MKSB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVFbmQnLCAnPGlmcmFtZSBuYW1lPVwiJyArIGlmcmFtZUlkICsgJ1wiIGlkPVwiJyArIGlmcmFtZUlkICsgJ1wiIHN0eWxlPVwiZGlzcGxheTpub25lXCI+PC9pZnJhbWU+Jyk7XG4gICAgICB9XG4gICAgICBpZiAod2luZG93LmZyYW1lcyAmJiB3aW5kb3cuZnJhbWVzW2lmcmFtZUlkXSkge1xuICAgICAgICBhdXRoRnJhbWUgPSB3aW5kb3cuZnJhbWVzW2lmcmFtZUlkXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYXV0aEZyYW1lO1xuICB9XG5cbiAgX3NhdmVJdGVtKGtleSwgb2JqKSB7XG4gICAgaWYgKHRoaXMuY29uZmlnICYmIHRoaXMuY29uZmlnLmNhY2hlTG9jYXRpb24gJiYgdGhpcy5jb25maWcuY2FjaGVMb2NhdGlvbiA9PT0gJ2xvY2FsU3RvcmFnZScpIHtcbiAgICAgIGlmICghdGhpcy5fc3VwcG9ydHNMb2NhbFN0b3JhZ2UoKSkge1xuICAgICAgICB0aGlzLmluZm8oJ0xvY2FsIHN0b3JhZ2UgaXMgbm90IHN1cHBvcnRlZCcpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgb2JqKTtcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gRGVmYXVsdCBhcyBzZXNzaW9uIHN0b3JhZ2VcbiAgICBpZiAoIXRoaXMuX3N1cHBvcnRzU2Vzc2lvblN0b3JhZ2UoKSkge1xuICAgICAgdGhpcy5pbmZvKCdTZXNzaW9uIHN0b3JhZ2UgaXMgbm90IHN1cHBvcnRlZCcpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oa2V5LCBvYmopO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgX2dldEl0ZW0oa2V5KSB7XG4gICAgaWYgKHRoaXMuY29uZmlnICYmIHRoaXMuY29uZmlnLmNhY2hlTG9jYXRpb24gJiYgdGhpcy5jb25maWcuY2FjaGVMb2NhdGlvbiA9PT0gJ2xvY2FsU3RvcmFnZScpIHtcbiAgICAgIGlmICghdGhpcy5fc3VwcG9ydHNMb2NhbFN0b3JhZ2UoKSkge1xuICAgICAgICB0aGlzLmluZm8oJ0xvY2FsIHN0b3JhZ2UgaXMgbm90IHN1cHBvcnRlZCcpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgfVxuXG4gICAgLy8gRGVmYXVsdCBhcyBzZXNzaW9uIHN0b3JhZ2VcbiAgICBpZiAoIXRoaXMuX3N1cHBvcnRzU2Vzc2lvblN0b3JhZ2UoKSkge1xuICAgICAgdGhpcy5pbmZvKCdTZXNzaW9uIHN0b3JhZ2UgaXMgbm90IHN1cHBvcnRlZCcpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgfVxuXG4gIF9zdXBwb3J0c0xvY2FsU3RvcmFnZSgpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuICdsb2NhbFN0b3JhZ2UnIGluIHdpbmRvdyAmJiB3aW5kb3cubG9jYWxTdG9yYWdlO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBfc3VwcG9ydHNTZXNzaW9uU3RvcmFnZSgpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuICdzZXNzaW9uU3RvcmFnZScgaW4gd2luZG93ICYmIHdpbmRvdy5zZXNzaW9uU3RvcmFnZTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgX2Nsb25lQ29uZmlnKG9iaikge1xuICAgIGlmIChvYmogPT09IG51bGwgfHwgdHlwZW9mIG9iaiAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiBvYmo7XG4gICAgfVxuXG4gICAgY29uc3QgY29weSA9IHt9O1xuICAgIGZvciAoY29uc3QgYXR0ciBpbiBvYmopIHtcbiAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoYXR0cikpIHtcbiAgICAgICAgY29weVthdHRyXSA9IG9ialthdHRyXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNvcHk7XG4gIH1cblxuICBfYWRkTGliTWV0YWRhdGEoKSB7XG4gICAgLy8geC1jbGllbnQtU0tVXG4gICAgLy8geC1jbGllbnQtVmVyXG4gICAgcmV0dXJuICcmeC1jbGllbnQtU0tVPUpzJngtY2xpZW50LVZlcj0nICsgdGhpcy5fbGliVmVyc2lvbigpO1xuICB9XG5cbiAgbG9nKGxldmVsLCBtZXNzYWdlLCBlcnJvcikge1xuICAgIGlmIChsZXZlbCA8PSBMb2dnaW5nLmxldmVsKSB7XG4gICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvVVRDU3RyaW5nKCk7XG4gICAgICBsZXQgZm9ybWF0dGVkTWVzc2FnZSA9ICcnO1xuXG4gICAgICBpZiAodGhpcy5jb25maWcuY29ycmVsYXRpb25JZCkge1xuICAgICAgICBmb3JtYXR0ZWRNZXNzYWdlID0gdGltZXN0YW1wICsgJzonICsgdGhpcy5jb25maWcuY29ycmVsYXRpb25JZCArICctJyArIHRoaXMuX2xpYlZlcnNpb24oKSArICctJyArIHRoaXMuQ09OU1RBTlRTLkxFVkVMX1NUUklOR19NQVBbbGV2ZWxdICsgJyAnICsgbWVzc2FnZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZvcm1hdHRlZE1lc3NhZ2UgPSB0aW1lc3RhbXAgKyAnOicgKyB0aGlzLl9saWJWZXJzaW9uKCkgKyAnLScgKyB0aGlzLkNPTlNUQU5UUy5MRVZFTF9TVFJJTkdfTUFQW2xldmVsXSArICcgJyArIG1lc3NhZ2U7XG4gICAgICB9XG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBmb3JtYXR0ZWRNZXNzYWdlICs9ICdcXG5zdGFjazpcXG4nICsgZXJyb3Iuc3RhY2s7XG4gICAgICB9XG5cbiAgICAgIExvZ2dpbmcubG9nKGZvcm1hdHRlZE1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIGVycm9yKG1lc3NhZ2UsIGVycm9yKSB7XG4gICAgdGhpcy5sb2codGhpcy5DT05TVEFOVFMuTE9HR0lOR19MRVZFTC5FUlJPUiwgbWVzc2FnZSwgZXJyb3IpO1xuICB9XG5cbiAgd2FybihtZXNzYWdlKSB7XG4gICAgdGhpcy5sb2codGhpcy5DT05TVEFOVFMuTE9HR0lOR19MRVZFTC5XQVJOLCBtZXNzYWdlLCBudWxsKTtcbiAgfVxuXG4gIGluZm8obWVzc2FnZSkge1xuICAgIHRoaXMubG9nKHRoaXMuQ09OU1RBTlRTLkxPR0dJTkdfTEVWRUwuSU5GTywgbWVzc2FnZSwgbnVsbCk7XG4gIH1cblxuICB2ZXJib3NlKG1lc3NhZ2UpIHtcbiAgICB0aGlzLmxvZyh0aGlzLkNPTlNUQU5UUy5MT0dHSU5HX0xFVkVMLlZFUkJPU0UsIG1lc3NhZ2UsIG51bGwpO1xuICB9XG5cbiAgbmF2aWdhdGUodXJsKSB7XG4gICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UodXJsKTtcbiAgfVxuXG4gIGlzSWZyYW1lKCkge1xuICAgIHJldHVybiB3aW5kb3cucGFyZW50ICYmIHdpbmRvdy5wYXJlbnQgIT09IHdpbmRvdztcbiAgfVxuXG4gIG9wZW4odXJsLCBuYW1lLCBmZWF0dXJlcykge1xuICAgIHJldHVybiB3aW5kb3cub3Blbih1cmwsIG5hbWUsIGZlYXR1cmVzKTtcbiAgfVxuXG4gIF9saWJWZXJzaW9uKCkge1xuICAgIHJldHVybiAnMS4wLjEyJztcbiAgfVxufVxuXG5nbG9iYWwuTG9nZ2luZyA9IHtcbiAgbGV2ZWw6IDAsXG4gIGxvZzogKG1lc3NhZ2UpID0+IHt9XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9zYWx0ZS1hdXRoLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQTs7Ozs7OztBQU9BO0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBOzs7OztBQUtBO0FBQUE7QUFDQTtBQUFBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFkQTtBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQXhDQTtBQUNBO0FBMENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTs7Ozs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7Ozs7O0FBbHFDQTtBQUNBO0FBQ0E7QUFtcUNBO0FBQ0E7QUFDQTtBQUZBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ })
/******/ ]);
});
